# Check if python is installed
if test -f /git-bash.exe; then
    _BUILDENV_PYTHON={{ shWindowsPython }}
else
    _BUILDENV_PYTHON={{ linuxPython }}
fi
${_BUILDENV_PYTHON} --version 2>/dev/null 1>&2
if test $? -ne 0; then
    echo "[ERROR] ${_BUILDENV_PYTHON} is not installed"
    exit 1
fi

# Wrap to buildenv script
${_BUILDENV_PYTHON} buildenv-loader.py --from-loader=sh "$@"
_BUILDENV_RC=$?

# Check for specific RC
if test ${_BUILDENV_RC} -eq {{ rcStartShell }}; then
    # Spawn shell if required
    ${SHELL} --rcfile .buildenv/shell.sh
    _BUILDENV_RC=$?
elif test ${_BUILDENV_RC} -gt {{ rcStartShell }}; then
    # Execute command if required (and command script found)
    _BUILDENV_CMD=.buildenv/command.${_BUILDENV_RC}.sh
    if test -f ${_BUILDENV_CMD}; then
        ${SHELL} -c ${_BUILDENV_CMD}
        _BUILDENV_RC=$?
        rm ${_BUILDENV_CMD}
    fi
fi

# Forward RC
exit ${_BUILDENV_RC}
