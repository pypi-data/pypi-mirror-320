"use strict";(self.webpackChunk_jupyter_shared_drive_extension=self.webpackChunk_jupyter_shared_drive_extension||[]).push([[334,953],{953:(e,t,r)=>{r.r(t),r.d(t,{IGlobalAwareness:()=>n,IUserMenu:()=>o,RendererUserMenu:()=>w,UserInfoBody:()=>P,UserInfoPanel:()=>R,UserMenu:()=>x,remoteUserCursors:()=>b});var s=r(262);const o=new s.Token("@jupyter/collaboration:IUserMenu"),n=new s.Token("@jupyter/collaboration:IGlobalAwareness");var a=r(195),i=r(24),c=r(206);const l=a.Facet.define({combine:e=>e[e.length-1]}),d=i.EditorView.baseTheme({".jp-remote-cursor":{borderLeft:"1px solid black",marginLeft:"-1px"},".jp-remote-cursor.jp-mod-primary":{borderLeftWidth:"2px"},".jp-remote-selection":{opacity:.5},".cm-tooltip":{border:"none"},".cm-tooltip .jp-remote-userInfo":{color:"var(--jp-ui-inverse-font-color0)",padding:"0px 2px"}}),u=a.Annotation.define();class h{constructor(e,t){this.style=e,this.marker=t}draw(){const e=this.marker.draw();for(const[t,r]of Object.entries(this.style))e.style[t]=r;return e}eq(e){return this.marker.eq(e.marker)&&s.JSONExt.deepEqual(this.style,e.style)}update(e,t){for(const[t,r]of Object.entries(this.style))e.style[t]=r;return this.marker.update(e,t.marker)}}const m=(0,i.layer)({above:!0,markers(e){const{awareness:t,ytext:r}=e.state.facet(l),s=r.doc,o=[];return t.getStates().forEach(((n,l)=>{if(l===t.doc.clientID)return;const d=n.cursors;for(const t of d??[]){if(!t?.anchor||!t?.head)return;const l=(0,c.createAbsolutePositionFromRelativePosition)(t.anchor,s),d=(0,c.createAbsolutePositionFromRelativePosition)(t.head,s);if(l?.type!==r||d?.type!==r)return;const u=t.primary??1?"jp-remote-cursor jp-mod-primary":"jp-remote-cursor",m=a.EditorSelection.cursor(d.index,d.index>l.index?-1:1);for(const t of i.RectangleMarker.forRange(e,u,m))o.push(new h({borderLeftColor:n.user?.color??"black"},t))}})),o},update:(e,t)=>!!e.transactions.find((e=>e.annotation(u))),class:"jp-remote-cursors"}),p=(0,i.hoverTooltip)(((e,t)=>{const{awareness:r,ytext:s}=e.state.facet(l),o=s.doc;for(const[e,n]of r.getStates())if(e!==r.doc.clientID)for(const e of n.cursors??[]){if(!e?.head)continue;const r=(0,c.createAbsolutePositionFromRelativePosition)(e.head,o);if(r?.type===s&&r.index-3<=t&&t<=r.index+3)return{pos:r.index,above:!0,create:()=>{const e=document.createElement("div");return e.classList.add("jp-remote-userInfo"),e.style.backgroundColor=n.user?.color??"darkgrey",e.textContent=n.user?.display_name??"Anonymous",{dom:e}}}}return null}),{hideOn:(e,t)=>!!e.annotation(u),hoverTime:0}),f=(0,i.layer)({above:!1,markers(e){const{awareness:t,ytext:r}=e.state.facet(l),s=r.doc,o=[];return t.getStates().forEach(((n,l)=>{if(l===t.doc.clientID)return;const d=n.cursors;for(const t of d??[]){if((t.empty??1)||!t?.anchor||!t?.head)return;const l=(0,c.createAbsolutePositionFromRelativePosition)(t.anchor,s),d=(0,c.createAbsolutePositionFromRelativePosition)(t.head,s);if(l?.type!==r||d?.type!==r)return;const u="jp-remote-selection";for(const t of i.RectangleMarker.forRange(e,u,a.EditorSelection.range(l.index,d.index)))o.push(new h({backgroundColor:n.user?.color??"black"},t))}})),o},update:(e,t)=>!!e.transactions.find((e=>e.annotation(u))),class:"jp-remote-selections"}),y=i.ViewPlugin.fromClass(class{constructor(e){this.editorAwareness=e.state.facet(l),this._listener=({added:t,updated:r,removed:s})=>{t.concat(r).concat(s).findIndex((e=>e!==this.editorAwareness.awareness.doc.clientID))>=0&&e.dispatch({annotations:[u.of([])]})},this.editorAwareness.awareness.on("change",this._listener)}destroy(){this.editorAwareness.awareness.off("change",this._listener)}update(e){if(!e.docChanged&&!e.selectionSet)return;const{awareness:t,ytext:r}=this.editorAwareness,o=t.getLocalState();if(o){const n=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),a=e.state.selection,i=new Array;if(n&&a){for(const e of a.ranges){const t=e===a.main,s=(0,c.createRelativePositionFromTypeIndex)(r,e.anchor),o=(0,c.createRelativePositionFromTypeIndex)(r,e.head);i.push({anchor:s,head:o,primary:t,empty:e.empty})}if(!o.cursors||i.length>0){const e=o.cursors?.map((e=>({...e,anchor:e?.anchor?(0,c.createRelativePositionFromJSON)(e.anchor):null,head:e?.head?(0,c.createRelativePositionFromJSON)(e.head):null})));s.JSONExt.deepEqual(i,e)||t.setLocalStateField("cursors",i)}}}}},{provide:()=>[d,m,f,p,(0,i.tooltips)({position:"absolute",parent:document.body})]});function b(e){return[l.of(e),y]}var _=r(960),v=r(256),I=r(873);class w extends v.MenuBar.Renderer{constructor(e){super(),this._user=e}renderItem(e){const t=this.createItemClass(e),r=this.createItemDataset(e),s=this.createItemARIA(e);return I.h.li({className:t,dataset:r,tabindex:"0",onfocus:e.onfocus,...s},this._createUserIcon(),this.renderLabel(e),this.renderIcon(e))}renderLabel(e){const t=this.formatLabel(e);return I.h.div({className:"lm-MenuBar-itemLabel jp-MenuBar-label"},t)}_createUserIcon(){return this._user.isReady&&this._user.identity.avatar_url?I.h.div({className:"lm-MenuBar-itemIcon jp-MenuBar-imageIcon"},I.h.img({src:this._user.identity.avatar_url})):this._user.isReady?I.h.div({className:"lm-MenuBar-itemIcon jp-MenuBar-anonymousIcon",style:{backgroundColor:this._user.identity.color}},I.h.span({},this._user.identity.initials)):I.h.div({className:"lm-MenuBar-itemIcon jp-MenuBar-anonymousIcon"},_.userIcon)}}class x extends v.Menu{constructor(e){super(e)}}var g=r(594),j=r(345);const k=e=>{const{user:t}=e;return j.createElement("div",{className:"jp-UserInfo-Container"},j.createElement("div",{title:t.display_name,className:"jp-UserInfo-Icon",style:{backgroundColor:t.color}},j.createElement("span",null,t.initials)),j.createElement("h3",null,t.display_name))};class R extends v.Panel{constructor(e){super({}),this.addClass("jp-UserInfoPanel"),this._profile=e,this._body=null,this._profile.isReady?(this._body=new P(this._profile.identity),this.addWidget(this._body),this.update()):this._profile.ready.then((()=>{this._body=new P(this._profile.identity),this.addWidget(this._body),this.update()})).catch((e=>console.error(e)))}}class P extends g.ReactWidget{constructor(e){super(),this._user=e}get user(){return this._user}set user(e){this._user=e,this.update()}render(){return j.createElement(k,{user:this._user})}}}}]);