"use strict";(self.webpackChunk_jupyter_shared_drive_extension=self.webpackChunk_jupyter_shared_drive_extension||[]).push([[389],{389:(e,t,s)=>{s.r(t),s.d(t,{default:()=>w});var r=s(594),a=s(781),n=s(670),o=s(256),i=s(43),c=s(206);const d=Date.now,u=Math.floor,l=(Math.ceil,Math.abs,Math.imul,Math.round,Math.log10,Math.log2,Math.log,Math.sqrt,Number.isNaN,Math.pow,Math.sign,()=>new Map),h=()=>new Set,g=Array.from;Array.isArray;class p{constructor(){this._observers=l()}on(e,t){((e,t,s)=>{let r=e.get(t);return void 0===r&&e.set(t,r=s()),r})(this._observers,e,h).add(t)}once(e,t){const s=(...r)=>{this.off(e,s),t(...r)};this.on(e,s)}off(e,t){const s=this._observers.get(e);void 0!==s&&(s.delete(t),0===s.size&&this._observers.delete(e))}emit(e,t){return g((this._observers.get(e)||l()).values()).forEach((e=>e(...t)))}destroy(){this._observers=l()}}Object.assign;const f=Object.keys,m=e=>f(e).length,y=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v=(Object.freeze,(e,t)=>{if(null==e||null==t)return((e,t)=>e===t)(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;break;case Set:if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;break;case Map:if(e.size!==t.size)return!1;for(const s of e.keys())if(!t.has(s)||!v(e.get(s),t.get(s)))return!1;break;case Object:if(m(e)!==m(t))return!1;for(const s in e)if(!y(e,s)||!v(e[s],t[s]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!v(e[s],t[s]))return!1;break;default:return!1}return!0});class b extends p{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval((()=>{const e=d();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const t=[];this.meta.forEach(((s,r)=>{r!==this.clientID&&3e4<=e-s.lastUpdated&&this.states.has(r)&&t.push(r)})),t.length>0&&M(this,t,"timeout")}),u(3e3)),e.on("destroy",(()=>{this.destroy()})),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,s=this.meta.get(t),r=void 0===s?0:s.clock+1,a=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:r,lastUpdated:d()});const n=[],o=[],i=[],c=[];null===e?c.push(t):null==a?null!=e&&n.push(t):(o.push(t),v(a,e)||i.push(t)),(n.length>0||i.length>0||c.length>0)&&this.emit("change",[{added:n,updated:i,removed:c},"local"]),this.emit("update",[{added:n,updated:o,removed:c},"local"])}setLocalStateField(e,t){const s=this.getLocalState();null!==s&&this.setLocalState({...s,[e]:t})}getStates(){return this.states}}const M=(e,t,s)=>{const r=[];for(let s=0;s<t.length;s++){const a=t[s];if(e.states.has(a)){if(e.states.delete(a),a===e.clientID){const t=e.meta.get(a);e.meta.set(a,{clock:t.clock+1,lastUpdated:d()})}r.push(a)}}r.length>0&&(e.emit("change",[{added:[],updated:[],removed:r},s]),e.emit("update",[{added:[],updated:[],removed:r},s]))},w=[{id:"@jupyter/shared-drive-extension:userMenu",description:"Provide connected user menu.",requires:[],provides:i.IUserMenu,activate:e=>{const{commands:t}=e,{user:s}=e.serviceManager;return new i.UserMenu({commands:t,user:s})}},{id:"@jupyter/shared-drive-extension:user-menu-bar",description:"Add user menu to the interface.",autoStart:!0,requires:[i.IUserMenu,r.IToolbarWidgetRegistry],activate:async(e,t,s)=>{const{user:r}=e.serviceManager,a=new o.MenuBar({forceItemsPosition:{forceX:!1,forceY:!1},renderer:new i.RendererUserMenu(r)});a.id="jp-UserMenu",r.userChanged.connect((()=>a.update())),a.addMenu(t),s.addFactory("TopBar","user-menu",(()=>a))}},{id:"@jupyter/shared-drive-extension:rtcGlobalAwareness",description:"Add global awareness to share working document of users.",requires:[n.IStateDB],provides:i.IGlobalAwareness,activate:(e,t)=>{const{user:s}=e.serviceManager,r=new c.Doc,a=new b(r);return a.setLocalState({username:s.identity?.name,contents:[]}),a}},{id:"@jupyter/share-drive-extension:userEditorCursors",description:"Add CodeMirror extension to display remote user cursors and selections.",autoStart:!0,requires:[a.IEditorExtensionRegistry],activate:(e,t)=>{t.addExtension({name:"remote-user-cursors",factory(e){const{awareness:t,ysource:s}=e.model.sharedModel;return a.EditorExtensionRegistry.createImmutableExtension((0,i.remoteUserCursors)({awareness:t,ytext:s}))}})}}]}}]);