"use strict";(self.webpackChunk_mbektas_notebook_intelligence=self.webpackChunk_mbektas_notebook_intelligence||[]).push([[199],{68696:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ae});var o=n(32148),i=n(89594),a=n(58597),s=n(87315),l=n(92338),c=n(67862),r=n(76228),d=n(85810),u=n(101),g=n(12358),m=n(76960),p=n(35256),h=n(46167),C=n(32446),M=n(93345),b=n.n(M),v=n(67262),f=n(37227);async function A(e="",t={}){const n=g.ServerConnection.makeSettings(),o=a.URLExt.join(n.baseUrl,"notebook-intelligence",e);let i;try{i=await g.ServerConnection.makeRequest(o,t,n)}catch(e){throw new g.ServerConnection.NetworkError(e)}let s=await i.text();if(s.length>0)try{s=JSON.parse(s)}catch(e){console.log("Not a JSON response body.",i)}if(!i.ok)throw new g.ServerConnection.ResponseError(i,s.message||s);return s}var y,w,D,E,N,I=n(74602);!function(e){e.ChatRequest="chat-request",e.ChatUserInput="chat-user-input",e.ClearChatHistory="clear-chat-history",e.RunUICommandResponse="run-ui-command-response",e.GenerateCode="generate-code"}(y||(y={})),function(e){e.StreamMessage="stream-message",e.StreamEnd="stream-end",e.RunUICommand="run-ui-command"}(w||(w={})),function(e){e.LLMRaw="llm-raw",e.Markdown="markdown",e.MarkdownPart="markdown-part",e.HTML="html",e.Button="button",e.Anchor="anchor",e.Progress="progress",e.Confirmation="confirmation"}(D||(D={})),function(e){e.NotLoggedIn="NOT_LOGGED_IN",e.ActivatingDevice="ACTIVATING_DEVICE",e.LoggingIn="LOGGING_IN",e.LoggedIn="LOGGED_IN"}(N||(N={}));class k{static initialize(){this.updateGitHubLoginStatus(),setInterval((()=>{this.updateGitHubLoginStatus()}),2e3),k.initializeWebsocket()}static async initializeWebsocket(){const e=g.ServerConnection.makeSettings(),t=a.URLExt.join(e.wsUrl,"notebook-intelligence","chat");this._webSocket=new WebSocket(t),this._webSocket.onmessage=e=>{this._messageReceived.emit(e.data)}}static getLoginStatus(){return this._loginStatus}static getDeviceVerificationInfo(){return this._deviceVerificationInfo}static async loginToGitHub(){return this._loginStatus=N.ActivatingDevice,new Promise(((e,t)=>{A("gh-login",{method:"POST"}).then((t=>{e({verificationURI:t.verification_uri,userCode:t.user_code}),this.updateGitHubLoginStatus()})).catch((e=>{console.error(`The notebook_intelligence server extension appears to be missing.\n${e}`),t(e)}))}))}static async logoutFromGitHub(){return this._loginStatus=N.ActivatingDevice,new Promise(((e,t)=>{A("gh-logout",{method:"GET"}).then((t=>{this.updateGitHubLoginStatus().then((()=>{e(t)}))})).catch((e=>{console.error(`The notebook_intelligence server extension appears to be missing.\n${e}`),t(e)}))}))}static async updateGitHubLoginStatus(){return new Promise(((e,t)=>{A("gh-login-status").then((t=>{this._loginStatus=t.status,this._deviceVerificationInfo.verificationURI=t.verification_uri||"",this._deviceVerificationInfo.userCode=t.user_code||"",e()})).catch((e=>{console.error(`The notebook_intelligence server extension appears to be missing.\n${e}`),t(e)}))}))}static async chatRequest(e,t,n,o,i){const a=v.UUID.uuid4();this._messageReceived.connect(((e,t)=>{(t=JSON.parse(t)).id===a&&i.emit(t)})),this._webSocket.send(JSON.stringify({id:a,type:y.ChatRequest,data:{chatId:e,prompt:t,language:n,filename:o}}))}static async generateCode(e,t,n,o,i,a,s,l){const c=v.UUID.uuid4();this._messageReceived.connect(((e,t)=>{(t=JSON.parse(t)).id===c&&l.emit(t)})),this._webSocket.send(JSON.stringify({id:c,type:y.GenerateCode,data:{chatId:e,prompt:t,prefix:n,suffix:o,existingCode:i,language:a,filename:s}}))}static async sendChatUserInput(e,t){this._webSocket.send(JSON.stringify({id:e,type:y.ChatUserInput,data:t}))}static async sendWebSocketMessage(e,t,n){this._webSocket.send(JSON.stringify({id:e,type:t,data:n}))}static async inlineCompletionsRequest(e,t,n,o){return A("inline-completions",{method:"POST",body:JSON.stringify({prefix:e,suffix:t,language:n,filename:o})})}}E=k,k._loginStatus=N.NotLoggedIn,k._deviceVerificationInfo={verificationURI:"",userCode:""},k._messageReceived=new I.Signal(E);var x,j=n(14067),L=n.n(j),S=n(93798),T=n.n(S),z=n(50238),O=n(50695),R=n(39439);function W({children:e,getApp:t}){const n=t();return b().createElement(L(),{remarkPlugins:[T()],components:{code({node:e,inline:t,className:o,children:i,getApp:a,...s}){const l=/language-(\w+)/.exec(o||""),c=String(i).replace(/\n$/,""),r=l?l[1]:"text";return!t&&l?b().createElement("div",null,b().createElement("div",{className:"code-block-header"},b().createElement("div",{className:"code-block-header-language"},b().createElement("span",null,r)),b().createElement("div",{className:"code-block-header-button",onClick:()=>{navigator.clipboard.writeText(c)}},b().createElement(R.ASe,{size:16,title:"Copy to clipboard"}),b().createElement("span",null,"Copy")),b().createElement("div",{className:"code-block-header-button",onClick:()=>{n.commands.execute("notebook-intelligence:insert-at-cursor",{language:r,code:c})}},b().createElement(R.Mo,{size:16,title:"Insert at cursor"})),b().createElement("div",{className:"code-block-header-button",onClick:()=>{n.commands.execute("notebook-intelligence:create-new-file",{language:r,code:c})}},b().createElement(R.NEl,{size:16,title:"New file"})),"python"===r&&b().createElement("div",{className:"code-block-header-button",onClick:()=>{n.commands.execute("notebook-intelligence:create-new-notebook-from-py",{language:r,code:c})}},b().createElement(R.YER,{size:16,title:"New notebook"}))),b().createElement(z.Prism,{style:O.f$,PreTag:"div",language:r,...s},c)):b().createElement("code",{className:o,...s},i)}}},e)}function _(e){return e.replace(/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,"")}function G(e){e=function(e){const t=e.split("\n"),n=[];for(const e of t)if(e.length>3&&e.startsWith("```")){n.push("```");let t=e.substring(3);if(t.startsWith("python")){if(6===t.length)continue;t=t.substring(6)}t.endsWith("```")?(n.push(t.substring(0,t.length-3)),n.push("```")):n.push(t)}else e.length>3&&e.endsWith("```")?(n.push(e.substring(0,e.length-3)),n.push("```")):n.push(e);return n.join("\n")}(e);const t=/^```(?:\w+)?\s*\n(.*?)(?=^```)```/gms;let n,o="";for(;null!==(n=t.exec(e));)o+=n[1]+"\n";return o.trim()||e}!function(e){e[e.Chat=0]="Chat",e[e.ExplainThis=1]="ExplainThis",e[e.FixThis=2]="FixThis",e[e.GenerateCode=3]="GenerateCode",e[e.ExplainThisOutput=4]="ExplainThisOutput",e[e.TroubleshootThisOutput=5]="TroubleshootThisOutput"}(x||(x={}));class U extends i.ReactWidget{constructor(e){super(),this.node.style.height="100%",this._getActiveDocumentInfo=e.getActiveDocumentInfo,this._openFile=e.openFile,this._getApp=e.getApp}render(){return b().createElement(J,{getActiveDocumentInfo:this._getActiveDocumentInfo,openFile:this._openFile,getApp:this._getApp})}}class P extends i.ReactWidget{constructor(e,t){super(),this.node.style.boxShadow="rgba(90, 76, 191, 0.8) 0px 0px 4px 4px",this.node.style.top=`${e.top+32}px`,this.node.style.left=`${e.left}px`,this.node.style.zIndex="1000",this.node.style.width=e.width+"px",this.node.style.height="42px",this.node.style.border="1px solid var(--jp-border-color0)",this._options=t,this.node.addEventListener("focusout",(e=>{this.node.contains(e.relatedTarget)||this._options.onRequestCancelled()}))}updatePosition(e){this.node.style.top=`${e.top+32}px`,this.node.style.left=`${e.left}px`,this.node.style.width=e.width+"px"}_onResponse(e){var t,n,o,i,a;if(e.type===w.StreamMessage){if(!(null===(n=null===(t=e.data.choices)||void 0===t?void 0:t[0])||void 0===n?void 0:n.delta))return;const s=null===(a=null===(i=null===(o=e.data.choices)||void 0===o?void 0:o[0])||void 0===i?void 0:i.delta)||void 0===a?void 0:a.content;if(!s)return;this._options.onContentStream(s)}else e.type===w.StreamEnd&&this._options.onContentStreamEnd()}_onRequestSubmitted(e){""!==this._options.existingCode&&(this.node.style.height="300px"),this._options.prompt=e,this._options.onRequestSubmitted(e)}render(){return b().createElement(H,{prompt:this._options.prompt,existingCode:this._options.existingCode,onRequestSubmitted:this._onRequestSubmitted.bind(this),onRequestCancelled:this._options.onRequestCancelled,onResponseEmit:this._onResponse.bind(this),prefix:this._options.prefix,suffix:this._options.suffix,onUpdatedCodeChange:this._options.onUpdatedCodeChange,onUpdatedCodeAccepted:this._options.onUpdatedCodeAccepted})}}class Q extends i.ReactWidget{constructor(e){super(),this._getApp=e.getApp}render(){return b().createElement(q,{getApp:this._getApp})}}class Z extends i.ReactWidget{constructor(e){super(),this._onLoggedIn=e.onLoggedIn}render(){return b().createElement(X,{onLoggedIn:()=>this._onLoggedIn()})}}const V=new Map;function Y(e){const t=e.message,n=t.date.toLocaleTimeString("en-US",{hour12:!1}),o=(t,n)=>{e.getApp().commands.execute(t,n)},i=[];let a;for(let e=0;e<t.contents.length;e++){const n=t.contents[e];n.type===a&&a===D.MarkdownPart?i[i.length-1].content+=n.content:(i.push(structuredClone(n)),a=n.type)}return b().createElement("div",{className:`chat-message chat-message-${t.from}`},b().createElement("div",{className:"chat-message-header"},b().createElement("div",{className:"chat-message-from"},b().createElement("div",{className:"chat-message-from-title"},"user"===t.from?"User":"Copilot"),b().createElement("div",{className:"chat-message-from-progress",style:{display:e.showGenerating?"visible":"none"}},b().createElement("div",{className:"loading-ellipsis"},"Generating"))),b().createElement("div",{className:"chat-message-timestamp"},n)),b().createElement("div",{className:"chat-message-content"},i.map(((t,n)=>{switch(t.type){case D.Markdown:case D.MarkdownPart:return b().createElement(W,{key:`key-${n}`,getApp:e.getApp},t.content);case D.HTML:return b().createElement("div",{key:`key-${n}`,dangerouslySetInnerHTML:{__html:t.content}});case D.Button:return b().createElement("div",null,b().createElement("button",{key:`key-${n}`,className:"jp-Dialog-button jp-mod-accept jp-mod-styled",onClick:()=>o(t.content.commandId,t.content.args)},b().createElement("div",{className:"jp-Dialog-buttonLabel"},t.content.title)));case D.Anchor:return b().createElement("div",null,b().createElement("a",{key:`key-${n}`,href:t.content.uri,target:"_blank"},t.content.title));case D.Progress:return n===i.length-1?b().createElement("div",{key:`key-${n}`},"✓ ",t.content):null;case D.Confirmation:return"confirmed"===V.get(t.id)?null:"canceled"===V.get(t.id)?b().createElement("div",null,"✖ Canceled"):b().createElement("div",{className:"chat-confirmation-form",key:`key-${n}`},t.content.title?b().createElement("div",null,b().createElement("b",null,t.content.title)):null,t.content.message?b().createElement("div",null,t.content.message):null,b().createElement("button",{className:"jp-Dialog-button jp-mod-accept jp-mod-styled",onClick:()=>{var e;e=t.id,V.set(e,"confirmed"),o("notebook-intelligence:chat-user-input",t.content.confirmArgs)}},b().createElement("div",{className:"jp-Dialog-buttonLabel"},"Proceed")),b().createElement("button",{className:"jp-Dialog-button jp-mod-reject jp-mod-styled",onClick:()=>{var e;e=t.id,V.set(e,"canceled"),o("notebook-intelligence:chat-user-input",t.content.cancelArgs)}},b().createElement("div",{className:"jp-Dialog-buttonLabel"},"Cancel")))}return null})),t.notebookLink&&b().createElement("a",{className:"copilot-generated-notebook-link","data-ref":t.notebookLink,onClick:t=>{const n=t.target.dataset.ref;e.openFile(n)}},"open notebook")))}async function F(e,t){switch(e.type){case x.Chat:case x.ExplainThis:case x.FixThis:case x.ExplainThisOutput:case x.TroubleshootThisOutput:return k.chatRequest(e.chatId,e.content,e.language||"python",e.filename||"Untitled.ipynb",t);case x.GenerateCode:return k.generateCode(e.chatId,e.content,e.prefix||"",e.suffix||"",e.existingCode||"",e.language||"python",e.filename||"Untitled.ipynb",t)}}function J(e){const[t,n]=(0,M.useState)([]),[o,i]=(0,M.useState)(""),[a,s]=(0,M.useState)(""),l=(0,M.useRef)(null),[c,r]=(0,M.useState)(N.NotLoggedIn),[d,u]=(0,M.useState)(0),[g,m]=(0,M.useState)(!1),[p,h]=(0,M.useState)(!1),[C,f]=(0,M.useState)([]),[E,I]=(0,M.useState)([]),[j,L]=(0,M.useState)(0),S=(0,M.useRef)(null),[T,z]=(0,M.useState)([]),[O,W]=(0,M.useState)(0),[_,G]=(0,M.useState)(v.UUID.uuid4());(0,M.useEffect)((()=>{A("capabilities",{method:"GET"}).then((e=>{const t=[];for(const n of e.chat_participants){const e=n.id,o=n.commands,i="default"===e?"":`@${e}`;""!==i&&t.push(i);const a=""===i?"":`${i} `;for(const e of o)t.push(`${a}/${e}`)}f(t),I(t)})).catch((e=>{console.error(`The notebook_intelligence server extension appears to be missing.\n${e}`)}))}),[]),(0,M.useEffect)((()=>{const e=()=>{r(k.getLoginStatus())};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[d]),(0,M.useEffect)((()=>{L(0)}),[E]);const U=e=>{var t;e.includes(o)?i(`${e} `):i(`${e} ${o} `),h(!1),null===(t=S.current)||void 0===t||t.focus(),L(0)},P=async()=>{W(T.length+1),z([...T,o]),h(!1);const a=[],s=o.split(" ");if(s.length>1)for(let e=0;e<Math.min(s.length,2);e++){const t=s[e];(t.startsWith("@")||t.startsWith("/"))&&a.push(t)}const l=a.length>0?a.join(" ")+" ":"",c=v.UUID.uuid4(),r=[...t,{id:c,date:new Date,from:"user",contents:[{id:c,type:D.Markdown,content:o}]}];if(n(r),o.startsWith("/clear"))return n([]),i(""),V(),Z(),z([]),W(0),void k.sendWebSocketMessage(v.UUID.uuid4(),y.ClearChatHistory,{chatId:_});m(!0);const d=e.getActiveDocumentInfo(),u=o,g=d.parentDirectory,p=[],C=e.getApp();F({chatId:_,type:x.Chat,content:u,language:d.language,filename:d.filename,parentDirectory:g},{emit:async e=>{var t,o,i,a,s;let l="";if(e.type===w.StreamMessage){const n=null===(o=null===(t=e.data.choices)||void 0===t?void 0:t[0])||void 0===o?void 0:o.delta;if(!n)return;if(n.nbiContent){const t=n.nbiContent;p.push({id:e.id,type:t.type,content:t.content})}else{if(l=null===(s=null===(a=null===(i=e.data.choices)||void 0===i?void 0:i[0])||void 0===a?void 0:a.delta)||void 0===s?void 0:s.content,!l)return;p.push({id:e.id,type:D.MarkdownPart,content:l})}}else if(e.type===w.StreamEnd)m(!1);else if(e.type===w.RunUICommand){const t=e.id,n=await C.commands.execute(e.data.commandId,e.data.args),o={callback_id:e.data.callback_id,result:n};k.sendWebSocketMessage(t,y.RunUICommandResponse,o)}const c=v.UUID.uuid4();n([...r,{id:c,date:new Date,from:"copilot",contents:p}])}}),i(l),Q(l)},Q=e=>{const t=e.trimStart();I(""===t?C:C.filter((e=>e.includes(t))))},Z=()=>{I(C),L(0)},V=()=>{G(v.UUID.uuid4())};(0,M.useEffect)((()=>{(()=>{var e;null===(e=l.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()}),[g]);const J=(0,M.useCallback)((e=>{const o=e.detail;o.chatId=_;let i="";switch(o.type){case x.ExplainThis:i=`Explain this code:\n\`\`\`\n${o.content}\n\`\`\`\n`;break;case x.FixThis:i=`Fix this code:\n\`\`\`\n${o.content}\n\`\`\`\n`;break;case x.ExplainThisOutput:i=`Explain this notebook cell output: \n\`\`\`\n${o.content}\n\`\`\`\n`;break;case x.TroubleshootThisOutput:i=`Troubleshoot errors reported in the notebook cell output: \n\`\`\`\n${o.content}\n\`\`\`\n`}const a=v.UUID.uuid4(),s=[...t,{id:a,date:new Date,from:"user",contents:[{id:a,type:D.Markdown,content:i}]}];n(s),m(!0);const l=[];F(o,{emit:e=>{var t,o,i,a,c;if(e.type===w.StreamMessage){if(!(null===(o=null===(t=e.data.choices)||void 0===t?void 0:t[0])||void 0===o?void 0:o.delta))return;const n=null===(c=null===(a=null===(i=e.data.choices)||void 0===i?void 0:i[0])||void 0===a?void 0:a.delta)||void 0===c?void 0:c.content;if(!n)return;l.push({id:e.id,type:D.MarkdownPart,content:n})}else e.type===w.StreamEnd&&m(!1);const r=v.UUID.uuid4();n([...s,{id:r,date:new Date,from:"copilot",contents:l}])}})}),[t]);return(0,M.useEffect)((()=>(document.addEventListener("copilotSidebar:runPrompt",J),()=>{document.removeEventListener("copilotSidebar:runPrompt",J)})),[t]),b().createElement("div",{className:"sidebar"},b().createElement("div",{className:"sidebar-header"},b().createElement("div",{className:"sidebar-title"},"Copilot Chat")),c===N.NotLoggedIn&&b().createElement("div",{className:"sidebar-login-info"},b().createElement("div",null,"You are not logged in to GitHub Copilot. Please login now to activate chat."),b().createElement("div",null,b().createElement("button",{className:"jp-Dialog-button jp-mod-accept jp-mod-styled",onClick:async()=>{e.getApp().commands.execute("notebook-intelligence:open-github-copilot-login-dialog")}},b().createElement("div",{className:"jp-Dialog-buttonLabel"},"Login to GitHub Copilot")))),c===N.LoggedIn&&(0===t.length?b().createElement("div",{className:"sidebar-messages"},b().createElement("div",{className:"sidebar-greeting"},"Welcome! How can I assist you today?")):b().createElement("div",{className:"sidebar-messages"},t.map(((n,o)=>b().createElement(Y,{key:`key-${o}`,message:n,openFile:e.openFile,getApp:e.getApp,showGenerating:o===t.length-1&&"copilot"===n.from&&g}))),b().createElement("div",{ref:l}))),c===N.LoggedIn&&b().createElement("div",{className:"sidebar-user-input"},b().createElement("textarea",{ref:S,rows:3,onChange:e=>{const t=e.target.value;i(t);const n=t.trimStart();"@"===n||"/"===n?(h(!0),Q(n)):n.startsWith("@")||n.startsWith("/")||""===n?Q(n):h(!1)},onKeyDown:async e=>{if("Enter"===e.key){if(e.stopPropagation(),e.preventDefault(),p)return void U(E[j]);L(0),P()}else if("Tab"===e.key){if(p)return e.stopPropagation(),e.preventDefault(),void U(E[j])}else if("Escape"===e.key)e.stopPropagation(),e.preventDefault(),h(!1),L(0);else if("ArrowUp"===e.key){if(e.stopPropagation(),e.preventDefault(),p)return void L((j-1+E.length)%E.length);if(h(!1),T.length>0&&O===T.length&&s(o),T.length>0&&O>0&&O<=T.length){const e=T[O-1],t=O-1;i(e),W(t)}}else if("ArrowDown"===e.key){if(e.stopPropagation(),e.preventDefault(),p)return void L((j+1+E.length)%E.length);if(h(!1),T.length>0&&O>=0&&O<T.length){if(O===T.length-1)return i(a),void W(T.length);const e=T[O+1],t=O+1;i(e),W(t)}}},placeholder:"Ask Copilot...",spellCheck:!1,value:o}),b().createElement("div",{className:"user-input-context-row"}),b().createElement("div",{className:"user-input-footer"},b().createElement("div",null,b().createElement("a",{href:"javascript:void(0)",onClick:()=>{var e;h(!0),null===(e=S.current)||void 0===e||e.focus()},title:"Select chat participant"},"@")),b().createElement("div",{style:{flexGrow:1}}),b().createElement("div",null,b().createElement("button",{className:"jp-Dialog-button jp-mod-accept jp-mod-styled send-button",onClick:()=>P(),disabled:0===o.length},b().createElement(R.tON,null)," Send"))),p&&E.length>0&&b().createElement("div",{className:"user-input-autocomplete"},E.map(((e,t)=>b().createElement("div",{key:`key-${t}`,className:"user-input-autocomplete-item "+(t===j?"selected":""),"data-value":e,onClick:e=>(e=>{const t=e.target.dataset.value;U(t)})(e)},e))))))}function H(e){const[t,n]=(0,M.useState)(""),[o,i]=(0,M.useState)(!1),a=e.onRequestSubmitted,s=e.onResponseEmit;return b().createElement("div",{className:"inline-popover"},b().createElement($,{...e,onRequestSubmitted:e=>{n(""),i(!0),a(e)},onResponseEmit:e=>{var t,o,i,a,l;if(e.type===w.StreamMessage){if(!(null===(o=null===(t=e.data.choices)||void 0===t?void 0:t[0])||void 0===o?void 0:o.delta))return;const s=null===(l=null===(a=null===(i=e.data.choices)||void 0===i?void 0:i[0])||void 0===a?void 0:a.delta)||void 0===l?void 0:l.content;if(!s)return;n((e=>e+s))}else e.type===w.StreamEnd&&n((e=>G(e)));s(e)},limitHeight:""!==e.existingCode&&o}),""!==e.existingCode&&o&&b().createElement(b().Fragment,null,b().createElement(B,{...e,modifiedCode:t}),b().createElement("div",{className:"inline-popover-footer"},b().createElement("div",null,b().createElement("button",{className:"jp-Button jp-mod-accept jp-mod-styled jp-mod-small",onClick:()=>e.onUpdatedCodeAccepted()},"Accept")),b().createElement("div",null,b().createElement("button",{className:"jp-Button jp-mod-reject jp-mod-styled jp-mod-small",onClick:()=>e.onRequestCancelled()},"Cancel")))))}function B(e){const t=(0,M.useRef)(null),[n,o]=(0,M.useState)(null);return(0,M.useEffect)((()=>{const n=t.current;n.className="monaco-editor-container";const i=f.editor.createModel(e.existingCode,"text/plain"),a=f.editor.createModel(e.modifiedCode,"text/plain"),s=f.editor.createDiffEditor(n,{originalEditable:!1,automaticLayout:!0,theme:"false"===document.body.getAttribute("data-jp-theme-light")?"vs-dark":"vs"});s.setModel({original:i,modified:a}),a.onDidChangeContent((()=>{e.onUpdatedCodeChange(a.getValue())})),o(s)}),[]),(0,M.useEffect)((()=>{var t;null===(t=null==n?void 0:n.getModifiedEditor().getModel())||void 0===t||t.setValue(e.modifiedCode)}),[e.modifiedCode]),b().createElement("div",{ref:t,className:"monaco-editor-container"})}function $(e){const[t,n]=(0,M.useState)(e.prompt),o=(0,M.useRef)(null);return(0,M.useEffect)((()=>{var e;const t=o.current;t&&(t.select(),null===(e=o.current)||void 0===e||e.focus())}),[]),b().createElement("div",{className:"inline-prompt-container",style:{height:e.limitHeight?"40px":"100%"}},b().createElement("textarea",{ref:o,rows:3,onChange:e=>{const t=e.target.value;n(t)},onKeyDown:async n=>{"Enter"===n.key?(n.stopPropagation(),n.preventDefault(),e.onRequestSubmitted(t),(async()=>{const n=[],o=t.split(" ");if(o.length>1)for(let e=0;e<Math.min(o.length,2);e++){const t=o[e];(t.startsWith("@")||t.startsWith("/"))&&n.push(t)}F({chatId:v.UUID.uuid4(),type:x.GenerateCode,content:t,language:void 0,filename:void 0,parentDirectory:"",prefix:e.prefix,suffix:e.suffix,existingCode:e.existingCode},{emit:async t=>{e.onResponseEmit(t)}})})()):"Escape"===n.key&&(n.stopPropagation(),n.preventDefault(),e.onRequestCancelled())},placeholder:"Ask Copilot to generate Python code...",spellCheck:!1,value:t}))}function q(e){const[t,n]=(0,M.useState)(N.NotLoggedIn),[o,i]=(0,M.useState)(0);return(0,M.useEffect)((()=>{const e=()=>{n(k.getLoginStatus())};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[o]),b().createElement("div",{title:"GitHub Copilot: "+(t===N.LoggedIn?"Logged in":"Not logged in"),className:"github-copilot-status-bar",onClick:()=>{e.getApp().commands.execute("notebook-intelligence:open-github-copilot-login-dialog")},dangerouslySetInnerHTML:{__html:t===N.LoggedIn?'<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path d="M6.25 9.016C6.66421 9.016 7 9.35089 7 9.76399V11.26C7 11.6731 6.66421 12.008 6.25 12.008C5.83579 12.008 5.5 11.6731 5.5 11.26V9.76399C5.5 9.35089 5.83579 9.016 6.25 9.016Z"/><path d="M10.5 9.76399C10.5 9.35089 10.1642 9.016 9.75 9.016C9.33579 9.016 9 9.35089 9 9.76399V11.26C9 11.6731 9.33579 12.008 9.75 12.008C10.1642 12.008 10.5 11.6731 10.5 11.26V9.76399Z"/><path d="M7.86079 1.80482C7.91028 1.8577 7.95663 1.91232 8 1.96856C8.04337 1.91232 8.08972 1.8577 8.13921 1.80482C8.82116 1.07611 9.87702 0.90832 11.0828 1.04194C12.3131 1.17827 13.2283 1.56829 13.8072 2.29916C14.3725 3.01276 14.5 3.90895 14.5 4.77735C14.5 5.34785 14.447 5.92141 14.2459 6.428L14.4135 7.26391L14.4798 7.29699C15.4115 7.76158 16 8.71126 16 9.7501V11.0107C16 11.2495 15.9143 11.4478 15.844 11.5763C15.7691 11.7131 15.6751 11.8368 15.5851 11.9416C15.4049 12.1512 15.181 12.3534 14.9801 12.5202C14.7751 12.6907 14.5728 12.8419 14.4235 12.9494C14.1842 13.1217 13.9389 13.2807 13.6826 13.4277C13.3756 13.6038 12.9344 13.8361 12.3867 14.0679C11.2956 14.5296 9.75604 15 8 15C6.24396 15 4.70442 14.5296 3.61334 14.0679C3.06559 13.8361 2.62435 13.6038 2.31739 13.4277C2.0611 13.2807 1.81581 13.1217 1.57651 12.9494C1.42716 12.8419 1.2249 12.6907 1.01986 12.5202C0.819 12.3534 0.595113 12.1512 0.414932 11.9416C0.3249 11.8368 0.230849 11.7131 0.156031 11.5763C0.0857453 11.4478 0 11.2495 1.90735e-06 11.0107L0 9.7501C0 8.71126 0.588507 7.76158 1.52017 7.29699L1.5865 7.26391L1.75413 6.42799C1.55295 5.9214 1.5 5.34785 1.5 4.77735C1.5 3.90895 1.62745 3.01276 2.19275 2.29916C2.77172 1.56829 3.68694 1.17827 4.91718 1.04194C6.12298 0.90832 7.17884 1.07611 7.86079 1.80482ZM3.0231 7.7282L3 7.8434V12.0931C3.02086 12.1053 3.04268 12.1179 3.06543 12.131C3.32878 12.2821 3.71567 12.4861 4.19916 12.6907C5.17058 13.1017 6.50604 13.504 8 13.504C9.49396 13.504 10.8294 13.1017 11.8008 12.6907C12.2843 12.4861 12.6712 12.2821 12.9346 12.131C12.9573 12.1179 12.9791 12.1053 13 12.0931V7.8434L12.9769 7.7282C12.4867 7.93728 11.9022 8.01867 11.25 8.01867C10.1037 8.01867 9.19051 7.69201 8.54033 7.03004C8.3213 6.80703 8.14352 6.55741 8 6.28924C7.85648 6.55741 7.6787 6.80703 7.45967 7.03004C6.80949 7.69201 5.89633 8.01867 4.75 8.01867C4.09776 8.01867 3.51325 7.93728 3.0231 7.7282ZM6.76421 2.82557C6.57116 2.61928 6.12702 2.41307 5.08282 2.52878C4.06306 2.64179 3.60328 2.93176 3.36975 3.22656C3.12255 3.53861 3 4.01374 3 4.77735C3 5.56754 3.12905 5.94499 3.3082 6.1441C3.47045 6.32443 3.82768 6.52267 4.75 6.52267C5.60367 6.52267 6.08903 6.28769 6.38811 5.98319C6.70349 5.66209 6.91507 5.1591 7.00579 4.43524C7.12274 3.50212 6.96805 3.04338 6.76421 2.82557ZM9.23579 2.82557C9.03195 3.04338 8.87726 3.50212 8.99421 4.43524C9.08493 5.1591 9.29651 5.66209 9.61189 5.98319C9.91097 6.28769 10.3963 6.52267 11.25 6.52267C12.1723 6.52267 12.5295 6.32443 12.6918 6.1441C12.871 5.94499 13 5.56754 13 4.77735C13 4.01374 12.8775 3.53861 12.6303 3.22656C12.3967 2.93176 11.9369 2.64179 10.9172 2.52878C9.87298 2.41307 9.42884 2.61928 9.23579 2.82557Z"/></svg>\n':'<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path d="M7.86079 1.76938C7.91028 1.8224 7.95663 1.87717 8 1.93356C8.04336 1.87717 8.08972 1.8224 8.13921 1.76938C8.82116 1.03872 9.87702 0.870477 11.0828 1.00446C12.3131 1.14115 13.2283 1.53222 13.8072 2.26504C14.3725 2.98056 14.5 3.87915 14.5 4.74987C14.5 5.21326 14.4653 5.67866 14.3451 6.10875C13.9119 5.84737 13.4429 5.63921 12.9473 5.49331C12.9809 5.29773 13 5.05436 13 4.74987C13 3.98422 12.8774 3.50781 12.6303 3.19493C12.3967 2.89934 11.9369 2.60859 10.9172 2.49528C9.87298 2.37926 9.42884 2.58602 9.23579 2.79286C9.03195 3.01126 8.87725 3.47123 8.99421 4.40684C9.05402 4.88539 9.16638 5.26766 9.32639 5.56486C8.14474 5.96456 7.12813 6.72232 6.40569 7.70903C5.92566 7.90339 5.37217 7.99987 4.75 7.99987C4.09776 7.99987 3.51325 7.91826 3.0231 7.70862L3 7.82413V12.0852C3.02086 12.0974 3.04268 12.1101 3.06543 12.1232C3.32878 12.2747 3.71567 12.4793 4.19916 12.6844C4.59656 12.853 5.05487 13.0201 5.56004 13.1588C5.77061 13.7867 6.08221 14.3683 6.47552 14.8842C5.35549 14.7159 4.37511 14.3885 3.61334 14.0653C3.06559 13.8329 2.62435 13.6 2.31739 13.4234C2.16373 13.335 2.0432 13.2604 1.95925 13.2066C1.91725 13.1797 1.88437 13.158 1.86101 13.1423L1.83316 13.1235L1.82736 13.1195L1.81237 13.1094C1.79971 13.1008 1.7818 13.0886 1.75941 13.0731C1.71466 13.0422 1.65169 12.9981 1.57651 12.9438C1.42716 12.836 1.2249 12.6844 1.01986 12.5135C0.819 12.3461 0.595113 12.1435 0.414932 11.9333C0.3249 11.8282 0.230849 11.7042 0.156031 11.567C0.0857453 11.4382 0 11.2394 1.90735e-06 10.9999L0 9.73594C0 8.69432 0.588507 7.74209 1.52017 7.27626L1.5865 7.24309L1.75413 6.40494C1.55295 5.89699 1.5 5.3219 1.5 4.74987C1.5 3.87915 1.62745 2.98056 2.19275 2.26504C2.77172 1.53222 3.68694 1.14115 4.91717 1.00446C6.12298 0.870477 7.17884 1.03872 7.86079 1.76938ZM6.76421 2.79286C6.57116 2.58602 6.12702 2.37926 5.08282 2.49528C4.06305 2.60859 3.60327 2.89934 3.36974 3.19493C3.12255 3.50781 3 3.98422 3 4.74987C3 5.54218 3.12905 5.92064 3.3082 6.12028C3.47045 6.30109 3.82768 6.49987 4.75 6.49987C5.60367 6.49987 6.08903 6.26426 6.38811 5.95894C6.70349 5.63698 6.91507 5.13264 7.00579 4.40684C7.12274 3.47123 6.96805 3.01126 6.76421 2.79286Z"/><path d="M8.49808 14.8106C9.25887 15.3994 10.2135 15.7499 11.25 15.7499C13.7353 15.7499 15.75 13.7352 15.75 11.2499C15.75 9.60081 14.863 8.15893 13.54 7.37532C12.8692 6.97796 12.0862 6.74987 11.25 6.74987C10.417 6.74987 9.63686 6.97621 8.96772 7.37074C7.64049 8.1533 6.75 9.59759 6.75 11.2499C6.75 12.0588 6.96343 12.8178 7.33706 13.4738C7.63262 13.9927 8.02841 14.4471 8.49808 14.8106ZM10.5 8.74987C10.5 8.33566 10.8366 7.99987 11.2508 7.99987C11.6647 8.00031 12 8.33593 12 8.74987V10.9999C12 11.4141 11.6642 11.7499 11.25 11.7499C10.8358 11.7499 10.5 11.4141 10.5 10.9999V8.74987ZM11.25 14.4999C10.6977 14.4999 10.25 14.0522 10.25 13.4999C10.25 12.9476 10.6977 12.4999 11.25 12.4999C11.8023 12.4999 12.25 12.9476 12.25 13.4999C12.25 14.0522 11.8023 14.4999 11.25 14.4999Z"/></svg>\n'}})}function X(e){const[t,n]=(0,M.useState)(N.NotLoggedIn),[o,i]=(0,M.useState)(0),[a,s]=(0,M.useState)(!1),[l,c]=(0,M.useState)(""),[r,d]=(0,M.useState)("");(0,M.useEffect)((()=>{const t=()=>{const t=k.getLoginStatus();n(t),t===N.LoggedIn&&a&&setTimeout((()=>{e.onLoggedIn()}),1e3)};t();const o=setInterval(t,1e3);return()=>clearInterval(o)}),[o]);const u=async()=>{await k.logoutFromGitHub(),i(o+1)},g=t===N.LoggedIn;return b().createElement("div",{className:"github-copilot-login-dialog"},b().createElement("div",{className:"github-copilot-login-status"},b().createElement("h4",null,"Login status:"," ",b().createElement("span",{className:"github-copilot-login-status-text "+(g?"logged-in":"")},g?"Logged in":t===N.LoggingIn?"Logging in...":t===N.ActivatingDevice?"Activating device...":t===N.NotLoggedIn?"Not logged in":"Unknown"))),t===N.NotLoggedIn&&b().createElement(b().Fragment,null,b().createElement("div",null,"Your GitHub tokens, code and data are directly transferred to GitHub Copilot as needed without storing any copies other than keeping in the process memory."),b().createElement("div",null,b().createElement("a",{href:"https://github.com/features/copilot",target:"_blank"},"GitHub Copilot")," ","requires a subscription and it has a free tier. GitHub Copilot is subject to the"," ",b().createElement("a",{href:"https://docs.github.com/en/site-policy/github-terms/github-terms-for-additional-products-and-features",target:"_blank"},"GitHub Terms for Additional Products and Features"),"."),b().createElement("div",null,b().createElement("h4",null,"Privacy and terms"),"By using Copilot Chat you agree to"," ",b().createElement("a",{href:"https://docs.github.com/en/copilot/responsible-use-of-github-copilot-features/responsible-use-of-github-copilot-chat-in-your-ide",target:"_blank"},"GitHub Copilot chat terms"),". Review the terms to understand about usage, limitations and ways to improve Copilot Chat. Please review"," ",b().createElement("a",{href:"https://docs.github.com/en/site-policy/privacy-policies/github-general-privacy-statement",target:"_blank"},"Privacy Statement"),"."),b().createElement("div",null,b().createElement("button",{className:"jp-Dialog-button jp-mod-accept jp-mod-reject jp-mod-styled",onClick:async()=>{const e=await k.loginToGitHub();c(e.verificationURI),d(e.userCode),i(o+1),s(!0)}},b().createElement("div",{className:"jp-Dialog-buttonLabel"},"Login using your GitHub account")))),g&&b().createElement("div",null,b().createElement("button",{className:"jp-Dialog-button jp-mod-reject jp-mod-styled",onClick:u},b().createElement("div",{className:"jp-Dialog-buttonLabel"},"Logout"))),t===N.ActivatingDevice&&l&&r&&b().createElement("div",null,b().createElement("div",{className:"copilot-activation-message"},"Copy code"," ",b().createElement("span",{className:"user-code-span",onClick:()=>(navigator.clipboard.writeText(r),!0)},b().createElement("b",null,r," ",b().createElement("span",{className:"copy-icon",dangerouslySetInnerHTML:{__html:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="currentColor" d="M384 336l-192 0c-8.8 0-16-7.2-16-16l0-256c0-8.8 7.2-16 16-16l140.1 0L400 115.9 400 320c0 8.8-7.2 16-16 16zM192 384l192 0c35.3 0 64-28.7 64-64l0-204.1c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1L192 0c-35.3 0-64 28.7-64 64l0 256c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64L0 448c0 35.3 28.7 64 64 64l192 0c35.3 0 64-28.7 64-64l0-32-48 0 0 32c0 8.8-7.2 16-16 16L64 464c-8.8 0-16-7.2-16-16l0-256c0-8.8 7.2-16 16-16l32 0 0-48-32 0z"/></svg>\n'}})))," ","and enter at"," ",b().createElement("a",{href:l,target:"_blank"},l)," ","to allow access to GitHub Copilot from this app. Activation could take up to a minute after you enter the code.")),t===N.ActivatingDevice&&b().createElement("div",{style:{marginTop:"10px"}},b().createElement("button",{className:"jp-Dialog-button jp-mod-reject jp-mod-styled",onClick:u},b().createElement("div",{className:"jp-Dialog-buttonLabel"},"Cancel activation"))))}const K='<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="var(--jp-inverse-layout-color3)"><path d="M 5.398 10.807 C 5.574 10.931 5.785 10.998 6 10.997 C 6.216 10.998 6.427 10.93 6.602 10.804 C 6.78 10.674 6.915 10.494 6.989 10.286 L 7.436 8.913 C 7.551 8.569 7.744 8.256 8 7.999 C 8.257 7.743 8.569 7.549 8.913 7.434 L 10.304 6.983 C 10.456 6.929 10.594 6.84 10.706 6.724 C 10.817 6.608 10.901 6.467 10.949 6.313 C 10.998 6.159 11.01 5.996 10.985 5.837 C 10.96 5.677 10.898 5.526 10.804 5.394 C 10.67 5.208 10.479 5.071 10.26 5.003 L 8.885 4.556 C 8.541 4.442 8.228 4.249 7.971 3.993 C 7.714 3.736 7.52 3.424 7.405 3.079 L 6.953 1.691 C 6.881 1.489 6.748 1.314 6.571 1.191 C 6.439 1.098 6.286 1.036 6.125 1.012 C 5.965 0.987 5.801 1.001 5.646 1.051 C 5.492 1.101 5.351 1.187 5.236 1.301 C 5.12 1.415 5.033 1.555 4.98 1.708 L 4.523 3.108 C 4.409 3.443 4.22 3.748 3.97 3.999 C 3.721 4.25 3.418 4.441 3.083 4.557 L 1.692 5.005 C 1.541 5.06 1.404 5.149 1.292 5.265 C 1.18 5.381 1.097 5.521 1.048 5.675 C 1 5.829 0.988 5.992 1.013 6.151 C 1.038 6.31 1.099 6.462 1.192 6.593 C 1.32 6.773 1.501 6.908 1.709 6.979 L 3.083 7.424 C 3.524 7.571 3.91 7.845 4.193 8.212 C 4.356 8.423 4.481 8.66 4.564 8.912 L 5.016 10.303 C 5.088 10.507 5.222 10.683 5.398 10.807 Z M 11.535 14.849 C 11.671 14.946 11.834 14.997 12 14.997 C 12.165 14.997 12.326 14.946 12.461 14.851 C 12.601 14.753 12.706 14.613 12.761 14.451 L 13.009 13.689 C 13.063 13.531 13.152 13.387 13.269 13.268 C 13.387 13.15 13.531 13.061 13.689 13.009 L 14.461 12.757 C 14.619 12.703 14.756 12.6 14.852 12.464 C 14.926 12.361 14.974 12.242 14.992 12.117 C 15.011 11.992 14.999 11.865 14.959 11.745 C 14.918 11.625 14.85 11.516 14.76 11.428 C 14.669 11.34 14.559 11.274 14.438 11.236 L 13.674 10.987 C 13.516 10.935 13.372 10.846 13.254 10.729 C 13.136 10.611 13.047 10.467 12.994 10.309 L 12.742 9.536 C 12.689 9.379 12.586 9.242 12.449 9.146 C 12.347 9.073 12.23 9.025 12.106 9.006 C 11.982 8.987 11.855 8.998 11.736 9.037 C 11.616 9.076 11.508 9.142 11.419 9.231 C 11.33 9.319 11.264 9.427 11.224 9.546 L 10.977 10.308 C 10.925 10.466 10.838 10.61 10.721 10.728 C 10.607 10.845 10.467 10.934 10.312 10.987 L 9.539 11.239 C 9.38 11.293 9.242 11.396 9.145 11.533 C 9.047 11.669 8.995 11.833 8.996 12.001 C 8.997 12.169 9.051 12.333 9.15 12.468 C 9.249 12.604 9.388 12.705 9.547 12.757 L 10.31 13.004 C 10.469 13.058 10.614 13.147 10.732 13.265 C 10.851 13.384 10.939 13.528 10.99 13.687 L 11.243 14.461 C 11.298 14.618 11.4 14.753 11.535 14.849 Z"/></svg>\n';var ee;!function(e){e.chatuserInput="notebook-intelligence:chat-user-input",e.insertAtCursor="notebook-intelligence:insert-at-cursor",e.createNewFile="notebook-intelligence:create-new-file",e.createNewNotebookFromPython="notebook-intelligence:create-new-notebook-from-py",e.addCodeCellToNotebook="notebook-intelligence:add-code-cell-to-notebook",e.addMarkdownCellToNotebook="notebook-intelligence:add-markdown-cell-to-notebook",e.editorGenerateCode="notebook-intelligence:editor-generate-code",e.editorExplainThisCode="notebook-intelligence:editor-explain-this-code",e.editorFixThisCode="notebook-intelligence:editor-fix-this-code",e.editorExplainThisOutput="notebook-intelligence:editor-explain-this-output",e.editorTroubleshootThisOutput="notebook-intelligence:editor-troubleshoot-this-output",e.openGitHubCopilotLoginDialog="notebook-intelligence:open-github-copilot-login-dialog"}(ee||(ee={}));const te={cells:[],metadata:{},nbformat:4,nbformat_minor:5},ne={language:"python",filename:"Untitled.ipynb"};class oe{get schema(){return{default:{debouncerDelay:200}}}fetch(e,t){let n="",o="";const i=e.text.substring(0,e.offset),a=e.text.substring(e.offset);if(t.widget instanceof r.NotebookPanel){const e=t.widget.content.activeCell;let i=!1;for(const a of t.widget.content.widgets){const t=a.model.sharedModel;a===e?i=!0:i?"code"===t.cell_type&&(o+=t.source+"\n"):"code"===t.cell_type&&(n+=t.source+"\n")}}return new Promise(((e,t)=>{const s=[];k.getLoginStatus()===N.LoggedIn?k.inlineCompletionsRequest(n+i,a+o,ne.language,ne.filename).then((t=>{s.push({insertText:t.data}),e({items:s})})).catch((e=>{console.error(`The notebook_intelligence server extension appears to be missing.\n${e}`)})):e({items:s})}))}get name(){return"Notebook Intelligence"}get identifier(){return"@mbektas/notebook-intelligence"}}const ie={id:"@mbektas/notebook-intelligence:plugin",description:"Notebook Intelligence",autoStart:!0,requires:[c.ICompletionProviderManager,o.IDocumentManager,u.IDefaultFileBrowser],optional:[l.ISettingRegistry,C.IStatusBar],activate:(e,t,n,o,l,c)=>{var u;console.log("JupyterLab extension @mbektas/notebook-intelligence is activated!");let C=null;new m.LabIcon({name:"notebook-intelligence:sparkles-icon",svgstr:K}),t.registerInlineProvider(new oe),l&&l.load(ie.id).then((e=>{console.log("@mbektas/notebook-intelligence settings loaded:",e.composite)})).catch((e=>{console.error("Failed to load settings for @mbektas/notebook-intelligence.",e)}));const M=async t=>{const n=t.endsWith(".ipynb");return new Promise(((o,i)=>{const s=()=>{const i=a.URLExt.join(ne.parentDirectory||"",ne.filename),l=a.URLExt.join(ne.serverRoot||"",t),c=e.shell.currentWidget;i===l&&(n&&c instanceof r.NotebookPanel&&c.content.activeCell&&c.content.activeCell.node.contains(document.activeElement)||!n&&c instanceof d.FileEditorWidget&&c.content.editor.hasFocus())?o(!0):setTimeout(s,200)};s(),async function(){return new Promise((e=>{setTimeout((()=>{e()}),1e4)}))}().then((()=>{o(!1)}))}))},b=new p.Panel;b.id="notebook-intelligence-tab",b.title.caption="Copilot Chat";const v=new m.LabIcon({name:"ui-components:palette",svgstr:K});b.title.icon=v;const f=new U({getActiveDocumentInfo:()=>ne,openFile:e=>{n.openOrReveal(e)},getApp:()=>e});b.addWidget(f),e.shell.add(b,"left",{rank:1e3}),e.shell.activateById(b.id),e.commands.addCommand(ee.chatuserInput,{execute:e=>{k.sendChatUserInput(e.id,e.data)}}),e.commands.addCommand(ee.insertAtCursor,{execute:t=>{var n,o;const i=e.shell.currentWidget;if(i instanceof r.NotebookPanel){let e=i.content.activeCellIndex;e=-1===e?i.content.widgets.length:e+1,null===(n=i.model)||void 0===n||n.sharedModel.insertCell(e,{cell_type:"code",metadata:{trusted:!0},source:t.code}),i.content.activeCellIndex=e}else if(i instanceof d.FileEditorWidget){const e=i.content.editor,n=e.getCursorPosition();e.setCursorPosition(n),null===(o=e.replaceSelection)||void 0===o||o.call(e,t.code)}else e.commands.execute("apputils:notify",{message:"Open a notebook or file to insert the code at cursor",type:"error",options:{autoClose:!0}})}}),e.commands.addCommand(ee.createNewFile,{execute:async e=>{const t=new g.ContentsManager,i=await t.newUntitled({ext:".py",path:null==o?void 0:o.model.path});return t.save(i.path,{content:G(e.code),format:"text",type:"file"}),n.openOrReveal(i.path),await M(i.path),i}}),e.commands.addCommand(ee.createNewNotebookFromPython,{execute:async e=>{var t;let i=null;const a=new g.ContentsManager,s=new g.KernelSpecManager;await s.ready;const l=null===(t=s.specs)||void 0===t?void 0:t.kernelspecs;if(l)for(const e in l){const t=l[e];if("python"===(null==t?void 0:t.language)){i=t;break}}const c=await a.newUntitled({ext:".ipynb",path:null==o?void 0:o.model.path}),r=structuredClone(te);return i&&(r.metadata={kernelspec:{language:"python",name:i.name}}),e.code&&r.cells.push({cell_type:"code",metadata:{trusted:!0},source:[e.code],outputs:[]}),a.save(c.path,{content:r,format:"json",type:"notebook"}),n.openOrReveal(c.path),await M(c.path),c}});const A=()=>k.getLoginStatus()===N.LoggedIn,y=()=>e.shell.currentWidget instanceof r.NotebookPanel&&e.shell.currentWidget.content.activeCell instanceof s.CodeCell,w=(t,n,o)=>{const i=e.shell.currentWidget;if(!(i instanceof r.NotebookPanel&&i.sessionContext.path===t&&i.model))return e.commands.execute("apputils:notify",{message:`Failed to access the notebook: ${t}`,type:"error",options:{autoClose:!0}}),!1;const a=i.model.sharedModel,s=(e=>1===e.cells.length&&"code"===e.cells[0].cell_type&&""===e.cells[0].source)(a)?0:a.cells.length-1;return a.insertCell(s,{cell_type:n,metadata:{trusted:!0},source:o}),!0};e.commands.addCommand(ee.addCodeCellToNotebook,{execute:e=>w(e.path,"code",e.code)}),e.commands.addCommand(ee.addMarkdownCellToNotebook,{execute:e=>w(e.path,"markdown",e.markdown)}),e.commands.addCommand(ee.openGitHubCopilotLoginDialog,{execute:e=>{let t=null;const n=new Z({onLoggedIn:()=>null==t?void 0:t.dispose()});t=new i.Dialog({title:"GitHub Copilot Status",hasClose:!0,body:n,buttons:[]}),t.launch()}});const D={execute:t=>{const n=e.shell.currentWidget;if(!(n instanceof r.NotebookPanel&&n.content.activeCell))return;const o=n.content.activeCell,i=o.node.querySelector(".jp-InputArea-editor");if(!i)return;const a=n.node.querySelector(".jp-WindowedPanel-outer"),s=i.getBoundingClientRect(),l=()=>{if(null!==C){const e=i.getBoundingClientRect();C.updatePosition(e)}},c=new ResizeObserver(l),d=()=>{null!==C&&(c.unobserve(i),a&&a.removeEventListener("scroll",l),C=null,p.Widget.detach(y))},u="# nbi-prompt:";let g="",m="",h=o.model.sharedModel.source.trim();const M=h.split("\n");M.length>0&&M[0].startsWith(u)&&(g=M[0].substring(13).trim(),h=M.length>1?M.slice(1).join("\n"):"");const b=e=>(e=e.trim()).split("\n").filter((e=>!e.startsWith(u))).join("\n"),{prefix:v,suffix:f}=(()=>{let t="",n="";const o=e.shell.currentWidget;if(!(o instanceof r.NotebookPanel&&o.content.activeCell))return{prefix:t,suffix:n};const i=o.content.activeCell;let a=!1;for(const e of o.content.widgets){const o=e.model.sharedModel;e===i?a=!0:a?"code"===o.cell_type&&(n+=o.source+"\n"):"code"===o.cell_type&&(t+=o.source+"\n")}return{prefix:t,suffix:n}})(),A=()=>{m=`${u} ${g}\n${G(m)}`,o.model.sharedModel.source=m,m="",d()};d();const y=new P(s,{prompt:g,existingCode:h,prefix:b(v),suffix:b(f),onRequestSubmitted:e=>{g=e,m="",""===h&&d()},onRequestCancelled:()=>{d(),o.editor.focus()},onContentStream:e=>{""===h&&(m+=e,o.model.sharedModel.source=m)},onContentStreamEnd:()=>{""===h&&(A(),o.editor.focus())},onUpdatedCodeChange:e=>{m=e},onUpdatedCodeAccepted:()=>{A(),o.editor.focus()}});C=y,c.observe(i),a&&a.addEventListener("scroll",l),p.Widget.attach(y,document.body)},label:"Generate code",isEnabled:()=>A()&&y()};e.commands.addCommand(ee.editorGenerateCode,D);const E=new h.CommandRegistry;E.addCommand(ee.editorGenerateCode,D),E.addCommand(ee.editorExplainThisCode,{execute:()=>{const t=e.shell.currentWidget.content.activeCell,n=(null==t?void 0:t.model.sharedModel.source)||"";document.dispatchEvent(new CustomEvent("copilotSidebar:runPrompt",{detail:{type:x.ExplainThis,content:n,language:ne.language,filename:ne.filename}})),e.commands.execute("tabsmenu:activate-by-id",{id:b.id})},label:"Explain code",isEnabled:()=>A()&&y()}),E.addCommand(ee.editorFixThisCode,{execute:()=>{const t=e.shell.currentWidget.content.activeCell,n=(null==t?void 0:t.model.sharedModel.source)||"";document.dispatchEvent(new CustomEvent("copilotSidebar:runPrompt",{detail:{type:x.FixThis,content:n,language:ne.language,filename:ne.filename}})),e.commands.execute("tabsmenu:activate-by-id",{id:b.id})},label:"Fix code",isEnabled:()=>A()&&y()}),E.addCommand(ee.editorExplainThisOutput,{execute:()=>{let t="";const n=e.shell.currentWidget.content.activeCell.outputArea.model.toJSON();for(const e of n)"execute_result"===e.output_type?t+="object"==typeof e.data&&null!==e.data?e.data["text/plain"]:"\n":"stream"===e.output_type?t+=e.text+"\n":"error"===e.output_type&&Array.isArray(e.traceback)&&(t+=e.ename+": "+e.evalue+"\n",t+=e.traceback.map((e=>_(e))).join("\n")+"\n");document.dispatchEvent(new CustomEvent("copilotSidebar:runPrompt",{detail:{type:x.ExplainThisOutput,content:t,language:ne.language,filename:ne.filename}})),e.commands.execute("tabsmenu:activate-by-id",{id:b.id})},label:"Explain output",isEnabled:()=>{if(!(A()&&e.shell.currentWidget instanceof r.NotebookPanel))return!1;const t=e.shell.currentWidget.content.activeCell;if(!(t instanceof s.CodeCell))return!1;const n=t.outputArea.model.toJSON();return Array.isArray(n)&&n.length>0}}),E.addCommand(ee.editorTroubleshootThisOutput,{execute:()=>{let t="";const n=e.shell.currentWidget.content.activeCell.outputArea.model.toJSON();for(const e of n)"error"===e.output_type&&Array.isArray(e.traceback)&&(t+=e.ename+": "+e.evalue+"\n",t+=e.traceback.map((e=>_(e))).join("\n")+"\n");document.dispatchEvent(new CustomEvent("copilotSidebar:runPrompt",{detail:{type:x.TroubleshootThisOutput,content:t,language:ne.language,filename:ne.filename}})),e.commands.execute("tabsmenu:activate-by-id",{id:b.id})},label:"Troubleshoot errors in output",isEnabled:()=>{if(!(A()&&e.shell.currentWidget instanceof r.NotebookPanel))return!1;const t=e.shell.currentWidget.content.activeCell;if(!(t instanceof s.CodeCell))return!1;const n=t.outputArea.model.toJSON();return Array.isArray(n)&&n.length>0&&n.some((e=>"error"===e.output_type))}});const I=new p.Menu({commands:E});if(I.id="notebook-intelligence:editor-context-menu",I.title.label="Copilot",I.title.icon=v,I.addItem({command:ee.editorGenerateCode}),I.addItem({command:ee.editorExplainThisCode}),I.addItem({command:ee.editorFixThisCode}),I.addItem({command:ee.editorExplainThisOutput}),I.addItem({command:ee.editorTroubleshootThisOutput}),e.contextMenu.addItem({type:"submenu",submenu:I,selector:".jp-Editor",rank:1}),c){const t=new Q({getApp:()=>e});c.registerStatusItem("notebook-intelligence:github-copilot-status",{item:t,align:"right",rank:100,isActive:()=>!0})}const j=e;ne.serverRoot=j.paths.directories.serverRoot,ne.parentDirectory=ne.serverRoot+"/",null===(u=e.shell.currentChanged)||void 0===u||u.connect(((e,t)=>{var n,o,i,a;if(t.newValue instanceof r.NotebookPanel){const e=t.newValue;ne.filename=e.sessionContext.name,ne.language=(null===(a=null===(i=null===(o=null===(n=e.model)||void 0===n?void 0:n.sharedModel)||void 0===o?void 0:o.metadata)||void 0===i?void 0:i.kernelspec)||void 0===a?void 0:a.language)||"python";const s=e.sessionContext.path.lastIndexOf("/"),l=-1===s?"":e.sessionContext.path.substring(0,s);ne.parentDirectory=ne.serverRoot+"/"+l}else if(t.newValue instanceof d.FileEditorWidget){const e=t.newValue;ne.filename=e.context.path,ne.language="python";const n=e.context.path.lastIndexOf("/"),o=-1===n?"":e.context.path.substring(0,n);ne.parentDirectory=ne.serverRoot+"/"+o}})),k.initialize()}},ae=ie},68968:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAAHUlEQVQYV2PYvXu3JAi7uLiAMaYAjAGTQBPYLQkAa/0Zef3qRswAAAAASUVORK5CYII="},3552:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAL0lEQVQoz2NgCD3x//9/BhBYBWdhgFVAiVW4JBFKGIa4AqD0//9D3pt4I4tAdAMAHTQ/j5Zom30AAAAASUVORK5CYII="},62974:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAz0lEQVRIx2NgYGBY/R8I/vx5eelX3n82IJ9FxGf6tksvf/8FiTMQAcAGQMDvSwu09abffY8QYSAScNk45G198eX//yev73/4///701eh//kZSARckrNBRvz//+8+6ZohwCzjGNjdgQxkAg7B9WADeBjIBqtJCbhRA0YNoIkBSNmaPEMoNmA0FkYNoFKhapJ6FGyAH3nauaSmPfwI0v/3OukVi0CIZ+F25KrtYcx/CTIy0e+rC7R1Z4KMICVTQQ14feVXIbR695u14+Ir4gwAAD49E54wc1kWAAAAAElFTkSuQmCC"},54676:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCA1MyAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMCkiPg0KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik00OC4wMzY0IDQuMDEwNDJINC4wMDc3OUw0LjAwNzc5IDMyLjAyODZINDguMDM2NFY0LjAxMDQyWk00LjAwNzc5IDAuMDA3ODEyNUMxLjc5NzIxIDAuMDA3ODEyNSAwLjAwNTE4Nzk5IDEuNzk5ODQgMC4wMDUxODc5OSA0LjAxMDQyVjMyLjAyODZDMC4wMDUxODc5OSAzNC4yMzkyIDEuNzk3MjEgMzYuMDMxMiA0LjAwNzc5IDM2LjAzMTJINDguMDM2NEM1MC4yNDcgMzYuMDMxMiA1Mi4wMzkgMzQuMjM5MiA1Mi4wMzkgMzIuMDI4NlY0LjAxMDQyQzUyLjAzOSAxLjc5OTg0IDUwLjI0NyAwLjAwNzgxMjUgNDguMDM2NCAwLjAwNzgxMjVINC4wMDc3OVpNOC4wMTA0MiA4LjAxMzAySDEyLjAxM1YxMi4wMTU2SDguMDEwNDJWOC4wMTMwMlpNMjAuMDE4MiA4LjAxMzAySDE2LjAxNTZWMTIuMDE1NkgyMC4wMTgyVjguMDEzMDJaTTI0LjAyMDggOC4wMTMwMkgyOC4wMjM0VjEyLjAxNTZIMjQuMDIwOFY4LjAxMzAyWk0zNi4wMjg2IDguMDEzMDJIMzIuMDI2VjEyLjAxNTZIMzYuMDI4NlY4LjAxMzAyWk00MC4wMzEyIDguMDEzMDJINDQuMDMzOVYxMi4wMTU2SDQwLjAzMTJWOC4wMTMwMlpNMTYuMDE1NiAxNi4wMTgySDguMDEwNDJWMjAuMDIwOEgxNi4wMTU2VjE2LjAxODJaTTIwLjAxODIgMTYuMDE4MkgyNC4wMjA4VjIwLjAyMDhIMjAuMDE4MlYxNi4wMTgyWk0zMi4wMjYgMTYuMDE4MkgyOC4wMjM0VjIwLjAyMDhIMzIuMDI2VjE2LjAxODJaTTQ0LjAzMzkgMTYuMDE4MlYyMC4wMjA4SDM2LjAyODZWMTYuMDE4Mkg0NC4wMzM5Wk0xMi4wMTMgMjQuMDIzNEg4LjAxMDQyVjI4LjAyNkgxMi4wMTNWMjQuMDIzNFpNMTYuMDE1NiAyNC4wMjM0SDM2LjAyODZWMjguMDI2SDE2LjAxNTZWMjQuMDIzNFpNNDQuMDMzOSAyNC4wMjM0SDQwLjAzMTJWMjguMDI2SDQ0LjAzMzlWMjQuMDIzNFoiIGZpbGw9IiM0MjQyNDIiLz4NCjwvZz4NCjxkZWZzPg0KPGNsaXBQYXRoIGlkPSJjbGlwMCI+DQo8cmVjdCB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIGZpbGw9IndoaXRlIi8+DQo8L2NsaXBQYXRoPg0KPC9kZWZzPg0KPC9zdmc+DQo="},51240:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCA1MyAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMCkiPg0KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik00OC4wMzY0IDQuMDEwNDJINC4wMDc3OUw0LjAwNzc5IDMyLjAyODZINDguMDM2NFY0LjAxMDQyWk00LjAwNzc5IDAuMDA3ODEyNUMxLjc5NzIxIDAuMDA3ODEyNSAwLjAwNTE4Nzk5IDEuNzk5ODQgMC4wMDUxODc5OSA0LjAxMDQyVjMyLjAyODZDMC4wMDUxODc5OSAzNC4yMzkyIDEuNzk3MjEgMzYuMDMxMiA0LjAwNzc5IDM2LjAzMTJINDguMDM2NEM1MC4yNDcgMzYuMDMxMiA1Mi4wMzkgMzQuMjM5MiA1Mi4wMzkgMzIuMDI4NlY0LjAxMDQyQzUyLjAzOSAxLjc5OTg0IDUwLjI0NyAwLjAwNzgxMjUgNDguMDM2NCAwLjAwNzgxMjVINC4wMDc3OVpNOC4wMTA0MiA4LjAxMzAySDEyLjAxM1YxMi4wMTU2SDguMDEwNDJWOC4wMTMwMlpNMjAuMDE4MiA4LjAxMzAySDE2LjAxNTZWMTIuMDE1NkgyMC4wMTgyVjguMDEzMDJaTTI0LjAyMDggOC4wMTMwMkgyOC4wMjM0VjEyLjAxNTZIMjQuMDIwOFY4LjAxMzAyWk0zNi4wMjg2IDguMDEzMDJIMzIuMDI2VjEyLjAxNTZIMzYuMDI4NlY4LjAxMzAyWk00MC4wMzEyIDguMDEzMDJINDQuMDMzOVYxMi4wMTU2SDQwLjAzMTJWOC4wMTMwMlpNMTYuMDE1NiAxNi4wMTgySDguMDEwNDJWMjAuMDIwOEgxNi4wMTU2VjE2LjAxODJaTTIwLjAxODIgMTYuMDE4MkgyNC4wMjA4VjIwLjAyMDhIMjAuMDE4MlYxNi4wMTgyWk0zMi4wMjYgMTYuMDE4MkgyOC4wMjM0VjIwLjAyMDhIMzIuMDI2VjE2LjAxODJaTTQ0LjAzMzkgMTYuMDE4MlYyMC4wMjA4SDM2LjAyODZWMTYuMDE4Mkg0NC4wMzM5Wk0xMi4wMTMgMjQuMDIzNEg4LjAxMDQyVjI4LjAyNkgxMi4wMTNWMjQuMDIzNFpNMTYuMDE1NiAyNC4wMjM0SDM2LjAyODZWMjguMDI2SDE2LjAxNTZWMjQuMDIzNFpNNDQuMDMzOSAyNC4wMjM0SDQwLjAzMTJWMjguMDI2SDQ0LjAzMzlWMjQuMDIzNFoiIGZpbGw9IiNDNUM1QzUiLz4NCjwvZz4NCjxkZWZzPg0KPGNsaXBQYXRoIGlkPSJjbGlwMCI+DQo8cmVjdCB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIGZpbGw9IndoaXRlIi8+DQo8L2NsaXBQYXRoPg0KPC9kZWZzPg0KPC9zdmc+DQo="}}]);