import{a6 as _,u as l,j as e,C as k,a7 as N,B as w,a as C,b as D,r as d,w as q,k as m,l as x,m as h,n as f,aA as B,aB as E,g as u,t as b,h as T,F as M,z as j,L as P,p as g,aC as S,aD as F,aE as A,aF as y,i as L,T as I,v as H}from"./index-Be3uPtkT.js";import{R as O}from"./react-apexcharts.min-BNeL2krX.js";function K({metrics:s,timeInterval:r,className:a=""}){const n=d.useMemo(()=>{if(!s)return[];const i={};for(const c of s)i[c.name]||(i[c.name]=[]),i[c.name].push(c);return Object.entries(i).map(([c,o])=>({name:c.split("__")[0],data:o.map(p=>({x:q(new Date(p.time)),y:p.execution_time}))}))},[s]),t=d.useMemo(()=>({chart:{stacked:!1,toolbar:{show:!1}},dataLabels:{enabled:!1},yaxis:{title:{text:"Duration (seconds)"}},xaxis:{type:"datetime",tooltip:{enabled:!1},labels:{datetimeUTC:!1}}}),[]);return e.jsxs(m,{className:a,children:[e.jsxs(x,{children:[e.jsx(h,{children:"Tasks execution duration"}),e.jsx(f,{children:e.jsx(B,{className:"tabs-boxed tabs-sm",children:e.jsx(E,{className:"[--fallback-p:dodgerblue] [--fallback-pc:white]",isActive:!0,children:r.name})})})]}),e.jsx(O,{type:"line",series:n,options:t})]})}function R({dataSource:s,className:r=""}){const a=l({queryKey:["assets_sync",s.id],queryFn:()=>u.get(b(`/api/data_sources/sync?${T({source_id:s.id})}`)).then(()=>M.success("Asset synchronization triggered successfully!")),meta:{showError:!0},enabled:!1,retry:!1});return e.jsxs(m,{className:r,children:[e.jsxs(x,{divider:!0,children:[e.jsx(h,{children:"Properties"}),e.jsxs(f,{children:[s.is_assets_supported&&e.jsx(j,{className:"btn-primary",onClick:()=>a.refetch(),children:"Sync Assets"}),e.jsx(P,{to:"update",children:e.jsx(j,{className:"btn-primary",children:"Update"})})]})]}),e.jsx(g,{children:e.jsx(S,{children:e.jsx(F,{children:Object.entries(s??{}).map(([n,t])=>{if(!["id","credential_profile_id"].includes(n))return typeof t=="object"&&(t=(t==null?void 0:t.name)??JSON.stringify(t)),e.jsxs(A,{children:[e.jsx(y,{className:"pe-4",children:n}),e.jsx(y,{children:String(t)})]},n)})})})})]})}function z({metrics:s,className:r=""}){const a=H(),n=d.useMemo(()=>[a.accessor("time",{header:"Time"}),a.accessor("task",{header:"Task"}),a.accessor(c=>c.name.split("__",1)[0],{header:"Name"}),a.accessor("status",{header:"Status"}),a.accessor("message",{header:"Message"})],[a]),i={data:d.useMemo(()=>(s??[]).map(o=>({...o,time:L(new Date(o.time))})),[s]),columns:n,className:"min-w-full"};return e.jsxs(m,{className:r,children:[e.jsx(x,{children:e.jsx(h,{children:"Tasks execution history"})}),e.jsx(g,{children:e.jsx(I,{...i})})]})}const G=[{start_time:259200,end_time:0,name:"3 days"}];function U(){const s=_(),r=G[0],a=(s==null?void 0:s.dataSourceId)??"",n=(s==null?void 0:s.type)??"",t=l({queryKey:["datasources",n,a],queryFn:()=>u.get(b("/api/data_sources",n,a)).then(o=>o.data),meta:{showError:!0,errorMessage:"Failed to load Data Source data"}}),i=l({queryKey:["tasks_metrics",r.start_time,r.end_time,a],queryFn:()=>u.get(`/api/metrics/tasks?${T({start_time:r.start_time,end_time:r.end_time,origin:a})}`).then(o=>o.data),meta:{showError:!0,errorMessage:"Failed to load tasks metrics"}});return t.isPending||i.isPending?e.jsx(k,{}):!n||!a||!t.data?e.jsx(N,{}):e.jsxs(w,{className:"p-4",children:[e.jsx(C,{children:"Details"}),e.jsxs(D,{className:"flex flex-wrap gap-4",children:[e.jsx(R,{className:"w-[36rem]",dataSource:t.data}),e.jsx(K,{metrics:i.data,className:"w-[52rem] bg-base-100",timeInterval:r}),e.jsx(z,{className:"grow",metrics:i.data})]})]})}export{U as default};
