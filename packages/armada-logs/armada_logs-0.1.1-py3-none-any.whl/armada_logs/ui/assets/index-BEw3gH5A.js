import{x as u,r as i,y as j,t as c,j as e,z as v,M as f,A as g,u as p,s as y,C as m,D as E,g as d,E as T,F as l,G as P,H as C,I as S,J as M,B as U,k as b,l as A,m as B,n as _,p as w,T as L,b as k,L as q,U as F,v as N}from"./index-Be3uPtkT.js";import{u as x}from"./supportedUserProviders-pgZk5KV1.js";import"./logo_microsoft-CP2bHIYw.js";function H(){const{isOpen:t,open:r,close:o}=u(),[s,n]=i.useState(null),a=j(),h=()=>{n(null),o()};return i.useEffect(()=>{s&&a(c(s.type,s.id,"create"))},[s,a]),e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"btn-primary",onClick:r,children:"Add New"}),e.jsxs(f,{isOpen:t,close:h,className:"max-w-4xl h-3/4",children:[e.jsx(g,{children:"Select user provider"}),e.jsx(O,{onSelected:n})]})]})}function O({onSelected:t}){const r=p({queryKey:["providers"],queryFn:()=>d.get("/api/providers").then(s=>s.data)});if(r.isError)return e.jsx(y,{error:r.error});if(r.isPending)return e.jsx(m,{});if(!r.data)return null;const o=[];for(const s of r.data){if(!s.is_enabled)continue;const n=x.getUserProviderByType(s.entity_type);if(!n){console.error("SupportedUserProvider for "+s.entity_type+" does not exist");continue}if(!n.create.component){console.error("Create new user component of type "+s.entity_type+" does not exist");continue}o.push({name:s.name,description:s.description??"",icon:n.icon,type:s.entity_type,id:s.id})}return e.jsx(E,{items:o,filter:[{name:"Type",value:"type"}],onSelected:t})}function D({id:t,type:r}){const o=u(),s=T({mutationFn:()=>{const n=x.getUserProviderByType(r);if(!n)throw new Error(`Invalid user provider type - ${r}`);return d.delete(c(n.delete.route,t))},onSuccess:()=>l.success("The User was deleted"),onError:n=>l.error(P(n).message)});return e.jsxs(e.Fragment,{children:[e.jsx(C,{onClick:()=>o.setOpen(!0)}),e.jsx(S,{isOpen:o.isOpen,close:o.close,message:"Are you sure you want to delete this entry?",action:()=>s.mutate()})]})}function I({cell:t}){const r=t.row.getValue("provider_type"),o=String(t.getValue());return e.jsxs(k,{className:"flex gap-2",children:[e.jsx(q,{to:c(r,o,"update"),children:e.jsx(F,{})}),e.jsx(D,{type:r,id:o})]})}function R(){const t=p({queryKey:["users"],queryFn:()=>d.get("/api/users").then(a=>a.data)}),r=N(),o=i.useMemo(()=>[r.accessor("name",{header:"Name"}),r.accessor("email",{header:"Email"}),r.accessor("provider.name",{header:"Provider"}),r.accessor("provider.entity_type",{id:"provider_type",header:"Provider Type"}),r.accessor("role.name",{header:"Role"}),r.accessor("is_enabled",{header:"Enabled",cell:a=>e.jsx(M,{value:a.getValue()})}),r.accessor("id",{header:"Actions",cell:({cell:a})=>e.jsx(I,{cell:a})})],[r]),s=i.useMemo(()=>t.data??[],[t.data]),n=i.useMemo(()=>({data:s,columns:o,enablePagination:!0,initialState:{columnVisibility:{provider_type:!1}}}),[s,o]);return e.jsx(U,{children:e.jsxs(b,{children:[e.jsxs(A,{divider:!0,children:[e.jsx(B,{description:"Here you can create or modify the individual users of the system",children:"Users"}),e.jsx(_,{children:e.jsx(H,{})})]}),e.jsxs(w,{children:[t.isSuccess&&e.jsx(L,{...n}),t.isPending&&e.jsx(m,{}),t.isError&&e.jsx(y,{error:t.error})]})]})})}export{R as default};
