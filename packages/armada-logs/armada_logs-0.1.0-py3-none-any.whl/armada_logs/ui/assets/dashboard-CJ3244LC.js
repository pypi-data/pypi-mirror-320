import{r as n,j as e,B as q,a as F,b as p,u as h,C as S,S as g,c as f,d as j,e as y,f as w,g as x,h as T,i as D,k as E,l as M,m as N,n as L,o as C,p as A,q as B,T as I,s as R,N as H,t as P,v as O,w as k}from"./index-Be3uPtkT.js";import{R as Q}from"./react-apexcharts.min-BNeL2krX.js";function V({title:a,titleId:t,...i},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},i),a?n.createElement("title",{id:t},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"}))}const Z=n.forwardRef(V);function K({title:a,titleId:t,...i},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},i),a?n.createElement("title",{id:t},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z"}))}const W=n.forwardRef(K);function $({title:a,titleId:t,...i},r){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},i),a?n.createElement("title",{id:t},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"}))}const U=n.forwardRef($);function z(){var c,s,o,l;const a=h({queryKey:["datasources"],queryFn:()=>x.get("/api/data_sources").then(d=>d.data),meta:{showError:!0,errorMessage:"Failed to load Data Sources"}}),t=h({queryKey:["tasks_queue"],queryFn:()=>x.get("/api/metrics/tasks_queue").then(d=>d.data),refetchInterval:3e4,meta:{showError:!0,errorMessage:"Failed to load tasks queue state"}}),i=a.isPending||t.isPending,r=(((c=t.data)==null?void 0:c.size)??0)<20?"text-blue-400":"text-red-600";return i?e.jsx(S,{}):e.jsxs(p,{className:"flex flex-wrap gap-4",children:[e.jsxs(g,{className:"bg-base-100 w-96",children:[e.jsx(f,{className:"text-secondary",children:e.jsx(Z,{className:"w-10"})}),e.jsx(j,{children:"Data Sources"}),e.jsx(y,{className:"text-secondary",children:((s=a.data)==null?void 0:s.length)??"N/A"}),e.jsx(w,{children:"Total number of Data Sources"})]}),e.jsxs(g,{className:"bg-base-100 w-96",children:[e.jsx(f,{className:"text-success",children:e.jsx(U,{className:"w-10"})}),e.jsx(j,{children:"Active Data Sources"}),e.jsx(y,{className:"text-success",children:((o=a.data)==null?void 0:o.filter(d=>d.is_enabled==!0).length)??"N/A"}),e.jsx(w,{children:"Data Sources that are functional"})]}),e.jsxs(g,{className:"bg-base-100 w-96",children:[e.jsx(f,{className:r,children:e.jsx(W,{className:"w-10"})}),e.jsx(j,{children:"Tasks Queue"}),e.jsx(y,{className:r,children:((l=t.data)==null?void 0:l.size)??"N/A"}),e.jsx(w,{children:"Total number of tasks in queue"})]})]})}const b=[{start_time:86400,end_time:0,name:"1 day",key:"1 day"},{start_time:259200,end_time:0,name:"3 days",key:"3 days"}];function G({source:a}){return a?e.jsx(H,{className:"link link-primary",to:P("datasources/devices",a.entity_type??"",a.id),children:a.name}):null}function J({className:a=""}){const[t,i]=n.useState(b[0]),[r,c]=n.useState(""),s=h({queryKey:["tasks_metrics",t.start_time,t.end_time],queryFn:()=>x.get(`/api/metrics/tasks?${T({start_time:t.start_time,end_time:t.end_time,status:"error"})}`).then(m=>m.data),meta:{showError:!0,errorMessage:"Failed to load tasks execution metrics"}}),o=n.useMemo(()=>{const m=O();return[m.accessor("time",{header:"Time"}),m.accessor(u=>u.name.split("__",1)[0],{header:"Name"}),m.accessor("source",{header:"Source",cell:u=>e.jsx(G,{source:u.getValue()})}),m.accessor("task",{header:"Task"}),m.accessor("message",{header:"Message",cell:u=>{var v;return(u.getValue()??"").length>200?((v=u.getValue())==null?void 0:v.slice(0,200))+"...":u.getValue()}})]},[]),l=n.useMemo(()=>(s.data??[]).map(u=>({...u,time:D(new Date(u.time))})),[s.data]),d=n.useMemo(()=>({data:l,columns:o,enablePagination:!0,globalFilterFn:"includesString",state:{globalFilter:r}}),[r,o,l]);return e.jsxs(E,{className:a,children:[e.jsxs(M,{children:[e.jsx(N,{children:"Task execution failures"}),e.jsx(L,{children:e.jsx(C,{items:b,activeItem:t,onChange:i})})]}),e.jsxs(A,{children:[s.isPending&&e.jsx(S,{}),s.isSuccess&&e.jsxs(p,{className:"mt-6",children:[e.jsx(B,{value:r,onChange:c}),e.jsx(I,{...d})]}),s.isError&&e.jsx(R,{error:s.error})]})]})}const _=[{start_time:86400,end_time:0,name:"1 day",groupInterval:3600,key:"1 day"},{start_time:604800,end_time:0,name:"1 week",groupInterval:86400,key:"1 week"}];function X(a,t,i,r){const c=[];for(let s=t;s<i;s+=r*1e3)c.push({intervalStart:new Date(s),intervalEnd:new Date(s+r*1e3-1),count:0});return a.forEach(s=>{const o=new Date(s.time).getTime(),l=c.find(d=>o>=d.intervalStart.getTime()&&o<=d.intervalEnd.getTime());l&&(l.count+=1)}),c.map(s=>{const o=s.intervalStart;let l="";return r>=86400?l=k(o,"MM-dd"):r>=3600&&(l=k(o,"MM-dd HH")+"h"),{x:l,y:s.count}})}function Y({className:a=""}){const[t,i]=n.useState(_[0]),r=h({queryKey:["activity_metrics",t.start_time,t.end_time],queryFn:()=>x.get(`/api/metrics/activity?${T({start_time:t.start_time,end_time:t.end_time})}`).then(o=>o.data),meta:{showError:!0,errorMessage:"Failed to load activity metrics"}}),c=n.useMemo(()=>X(r.data??[],new Date().getTime()-t.start_time*1e3,new Date().getTime(),t.groupInterval),[t,r.data]),s=n.useMemo(()=>({chart:{stacked:!1,toolbar:{show:!1}},dataLabels:{enabled:!1},yaxis:{title:{text:"Event count"}},xaxis:{type:"category",tooltip:{enabled:!1},labels:{datetimeUTC:!1}}}),[]);return e.jsxs(E,{className:a,children:[e.jsxs(M,{children:[e.jsx(N,{children:"User activity"}),e.jsx(L,{children:e.jsx(C,{items:_,activeItem:t,onChange:i})})]}),e.jsx(Q,{type:"bar",series:[{name:"Events",data:c}],options:s,height:450})]})}function ae(){return e.jsxs(q,{children:[e.jsx(F,{children:"Overview"}),e.jsx(z,{}),e.jsxs(p,{className:"flex flex-wrap gap-4 mt-4",children:[e.jsx(Y,{className:"w-full 2xl:w-1/2 h-[32rem]"}),e.jsx(J,{className:"grow"})]})]})}export{ae as default};
