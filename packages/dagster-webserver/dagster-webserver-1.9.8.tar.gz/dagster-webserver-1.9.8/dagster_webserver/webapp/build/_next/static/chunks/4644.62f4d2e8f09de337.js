"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4644],{98012:function(e,n,t){t.d(n,{_:function(){return s}});var r=t(73235),l=t(4760);function i(){let e=(0,r._)(["\n  query InstanceConfigHasInfo {\n    instance {\n      id\n      hasInfo\n    }\n  }\n"]);return i=function(){return e},e}let s=()=>{var e;return!!(null===(e=(0,l.aM)(u).data)||void 0===e?void 0:e.instance.hasInfo)},u=(0,l.Ps)(i())},24644:function(e,n,t){t.r(n),t.d(n,{RunsRoot:function(){return z},default:function(){return L}});var r=t(52322),l=t(57164),i=t(48177),s=t(8637),u=t(71018),o=t(18984),a=t(15997),d=t(54123),c=t(1026),f=t(96795),h=t.n(f),x=t(2784),p=t(73235),m=t(97077),j=t(47933),v=t(4760),g=t(283),y=t(98012);function C(){let e=(0,p._)(['\n  query QueueDaemonStatusQuery {\n    instance {\n      id\n      daemonHealth {\n        id\n        daemonStatus(daemonType: "QUEUED_RUN_COORDINATOR") {\n          id\n          daemonType\n          healthy\n          required\n        }\n      }\n    }\n  }\n']);return C=function(){return e},e}let R=()=>{let e=(0,y._)();return(0,r.jsxs)(i.x,{flex:{direction:"column",gap:8},style:{minWidth:"100%"},border:"bottom",children:[e&&(0,r.jsx)(m.b,{intent:"info",title:(0,r.jsx)(j.rU,{to:"/config#run_coordinator",children:"View queue configuration"})}),e&&(0,r.jsx)(_,{})]})},_=()=>{let{data:e}=(0,v.aM)(w),{pageTitle:n}=(0,x.useContext)(g.N),t=null==e?void 0:e.instance.daemonHealth.daemonStatus;return(null==t?void 0:t.required)&&!(null==t?void 0:t.healthy)?(0,r.jsx)(m.b,{intent:"warning",title:"The queued run coordinator is not healthy.",description:(0,r.jsxs)("div",{children:["View ",(0,r.jsx)(j.rU,{to:"/health",children:n})," for details."]})}):null},w=(0,v.Ps)(C());var E=t(51188),b=t(20913),k=t(42530),q=t(41349),T=t(53852),A=t(94466),I=t(18149),P=t.n(I),N=t(95426);function O(){let e=(0,p._)(["\n  query TerminateRunIdsQuery($filter: RunsFilter!) {\n    pipelineRunsOrError(filter: $filter) {\n      ... on Runs {\n        results {\n          id\n          status\n          canTerminate\n        }\n      }\n    }\n  }\n"]);return O=function(){return e},e}let Q=e=>{let{refetch:n,filter:t,disabled:l}=e,[i,s]=(0,x.useState)(null),u=(0,v.xJ)(),o=async()=>{let e=await u.query({query:S,variables:{filter:t}});s("Runs"===e.data.pipelineRunsOrError.__typename?Object.fromEntries(e.data.pipelineRunsOrError.results.map(e=>[e.id,e.canTerminate])):{})};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N.A,{isOpen:null!==i,selectedRuns:i||{},selectedRunsAllQueued:P()(t,{statuses:Array.from(b.sy)}),onClose:()=>s(null),onComplete:()=>n()}),(0,r.jsx)(A.zx,{intent:"danger",outlined:!0,disabled:l,onClick:o,children:"Terminate allâ€¦"})]})},S=(0,v.Ps)(O());var H=t(54602),U=t(98933),D=t(96798),F=t(28316);function V(e){let{node:n}=e,t=x.useRef(null);return x.useLayoutEffect(()=>{let e=t.current;if(n.parentNode!==e){if(null!==n.parentNode&&n.parentNode!==e)throw Error("Cannot render the same node twice");return null==e||e.appendChild(n),()=>{null==e||e.removeChild(n)}}},[n]),(0,r.jsx)("div",{ref:t})}var M=t(16450),Y=t(36872);let z=()=>{(0,D.Px)();let[e,n]=(0,T.oD)(),t=(0,T.VH)(e),{queryResult:f,paginationProps:p}=(0,H.E)(t,25),m=(0,U.C4)(f,U.dT),j=(0,E.Qf)(e),v="all"!==j,[g,y]=h()(e,e=>"status"===e.token),C=(0,x.useCallback)(e=>{v?n([...g,...e]):n(e)},[n,v,g]),_=(0,x.useCallback)(e=>{let n=(0,l.HY)(e);y.some(e=>(0,l.HY)(e)===n)||C([...y,e])},[y,C]),w=(0,x.useMemo)(()=>{let e=["tag","snapshotId","id","job","pipeline","partition","backfill"];return v||e.push("status"),e},[v]),A=(0,x.useMemo)(()=>v?e.filter(e=>"status"!==e.token):e,[e,v]),{tabs:I,queryResult:P}=(0,E.zc)(t),N=(0,U.C4)(P,U.dT),O=(0,U.V5)(N,m),{button:S,activeFiltersJsx:z}=(0,T.Vv)({tokens:A,onChange:C,enabledFilters:w}),[L,$]=function(e){let[n,t]=x.useState(null);return x.useLayoutEffect(()=>{t(e=>null===e?document.createElement("div"):e)},[]),[n?(0,F.createPortal)(e,n):null,n?(0,r.jsx)(V,{node:n}):null]}(S);function B(){var e,n,l,s;return(0,r.jsxs)(i.x,{style:{width:"100%",marginRight:8},flex:{justifyContent:"space-between"},children:[(0,r.jsxs)(i.x,{flex:{direction:"row",alignItems:"center",gap:8},children:[I,$]}),"queued"===j?(0,r.jsx)(Q,{refetch:O.refetch,filter:{...t,statuses:Array.from(b.sy)},disabled:(null===(e=P.data)||void 0===e?void 0:e.queuedCount.__typename)!=="Runs"||(null===(n=P.data)||void 0===n?void 0:n.queuedCount.count)===0}):"in-progress"===j?(0,r.jsx)(Q,{refetch:O.refetch,filter:{...t,statuses:Array.from(b.Ys)},disabled:(null===(l=P.data)||void 0===l?void 0:l.inProgressCount.__typename)!=="Runs"||(null===(s=P.data)||void 0===s?void 0:s.inProgressCount.count)===0}):void 0]})}return(0,r.jsxs)(s.T,{children:[(0,r.jsx)(u.m,{title:(0,r.jsx)(o.X6,{children:"Runs"}),right:(0,r.jsx)(U.xi,{refreshState:O})}),L,(0,r.jsx)(q.Lw.Provider,{value:{refetch:f.refetch},children:(0,r.jsx)(M.g,{queryResult:f,allowStaleData:!0,renderError:e=>{let n=!!((null==e?void 0:e.networkError)&&"statusCode"in e.networkError&&400===e.networkError.statusCode);return(0,r.jsxs)(i.x,{flex:{direction:"column",gap:32},padding:{vertical:8,horizontal:24},children:[B(),(0,r.jsx)(a.t,{icon:"warning",title:n?"Invalid run filters":"Unexpected error",description:n?"The specified run filters are not valid. Please check the filters and try again.":"An unexpected error occurred. Check the console for details."})]})},children:e=>{let{pipelineRunsOrError:n}=e;return"Runs"!==n.__typename?(0,r.jsx)(i.x,{padding:{vertical:64},children:(0,r.jsx)(a.t,{icon:"error",title:"Query Error",description:n.message})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Y.Y,{$top:0,children:(0,r.jsx)(k.A,{runs:n.results,onAddTag:_,filter:t,actionBarComponents:B(),belowActionBarComponents:"queued"===j||z.length?(0,r.jsxs)(r.Fragment,{children:["queued"===j&&(0,r.jsx)(R,{}),z.length>0&&(0,r.jsxs)(r.Fragment,{children:[z,(0,r.jsx)(d.Z,{onClick:()=>C([]),children:"Clear all"})]})]}):null})}),n.results.length>0?(0,r.jsx)("div",{style:{marginTop:"16px"},children:(0,r.jsx)(c.pI,{...p})}):null]})}})})]})};var L=z}}]);
//# sourceMappingURL=4644.62f4d2e8f09de337.js.map