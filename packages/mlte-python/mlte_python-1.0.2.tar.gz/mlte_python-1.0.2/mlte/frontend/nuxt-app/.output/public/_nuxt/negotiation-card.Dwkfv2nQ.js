import{_ as G}from"./info-icon.DYvDc9G1.js";import{u as J,a as Q,_ as X,b as K,c as W,d as Y}from"./system-requirements.vue.Ca2bwrMl.js";import{n as Z,u as ee,r as f,H as m,v as te,q as O,A as j,w as y,B as ae,o as S,d as v,a as r,y as d,C as oe,b as g,c as se,t as N,z as ne}from"./entry.CcvhsfqQ.js";import{u as ie}from"./fetch.Bvj9IF8C.js";import{r as P,h as $}from"./http-error-handling.BbcmLHJS.js";import{i as L}from"./artifact-validation.BNGJNruX.js";import{c as le,i as re,s as ue}from"./form-methods.D-YS39W_.js";const ce=r("title",null,"Negotiation Card",-1),de=r("hr",null,null,-1),me={class:"usa-form-group"},pe=r("label",{class:"usa-label"}," System Context ",-1),_e=r("label",{class:"usa-label"}," Raw Data ",-1),fe=r("label",{class:"usa-label"}," Development Environment ",-1),ve=r("label",{class:"usa-label"}," Production Environment ",-1),ye=r("p",null," Teams should use the negotiation card to guide an in-depth discussion for project scoping. The card can be completed in any order and the idea is that teams fill out as much as they can at the beginning of the project process and revisit the card throughout as the project matures. There are four sections in the Negotiation Card: ",-1),ge=r("ul",null,[r("li",null,"System Information"),r("li",null,"Data"),r("li",null,"Model Information"),r("li",null,"System Requirements")],-1),he=r("p",null," Negotiation Cards serve as a critical reference for teams throughout development even when they are partially filled out. Hover over the black information icons next to each field to get more information about that field. Click on the Example button to see specific examples for a section. ",-1),be=r("br",null,null,-1),Ee={key:1},xe=r("h3",{style:{display:"inline"}},"Last Modified by:",-1),ke={class:"submit-footer"},Fe=Z({__name:"negotiation-card",async setup(Se){let I,C;const R=ne(),q=ee("token"),h=f(""),V=f(m().query.artifactId!==void 0),A=f(""),w=f(""),e=f({artifact_type:"negotiation_card",nc_data:{system:{goals:[{description:"",metrics:[{description:"",baseline:""}]}],problem_type:"classification",task:"",usage_context:"",risks:{fp:"",fn:"",other:""}},data:[{description:"",source:"",classification:"unclassified",access:"",labeling_method:"",labels:[{name:"",description:"",percentage:0}],fields:[{name:"",description:"",type:"",expected_values:"",missing_values:"",special_values:""}],rights:"",policies:""}],model:{development_compute_resources:{gpu:"0",cpu:"0",memory:"0",storage:"0"},deployment_platform:"",capability_deployment_mechanism:"",input_specification:[{name:"",description:"",type:"",expected_values:""}],output_specification:[{name:"",description:"",type:"",expected_values:""}],production_compute_resources:{gpu:"0",cpu:"0",memory:"0",storage:"0"}},system_requirements:[{quality:"<System Quality>",stimulus:"<Stimulus>",source:"<Source>",environment:"<Environment>",response:"<Response>",measure:"<Response Measure>"}]}}),F=f({identifier:!1}),D=J(),T=Q(),U=f(null),b=f(null),x=f(null);if(m().query.artifactId!==void 0){const n=m().query.model,t=m().query.version,u=m().query.artifactId;[I,C]=te(()=>ie(R.public.apiPath+"/model/"+n+"/version/"+t+"/artifact/"+u,{retry:0,method:"GET",headers:{Authorization:"Bearer "+q.value},onRequestError(){P()},onResponse({response:c}){var p,_;if(L(c._data)){A.value=c._data.header.creator,w.value=new Date(c._data.header.timestamp*1e3).toLocaleString("en-US"),e.value=c._data.body;const o=c._data.body.nc_data.system.problem_type;((p=T.value.find(a=>a.value===o))==null?void 0:p.value)!==void 0&&(e.value.nc_data.system.problem_type=(_=T.value.find(a=>a.value===o))==null?void 0:_.value),c._data.body.nc_data.data.forEach(a=>{var l,s;const i=a.classification;((l=D.value.find(k=>k.value===i))==null?void 0:l.value)!==void 0&&(a.classification=(s=D.value.find(k=>k.value===i))==null?void 0:s.value)})}},onResponseError({response:c}){$(c.status,c._data.error_description)}},"$XHCOMaBkE4")),await I,C()}async function M(){var _;const n=m().query.model,t=m().query.version;let u=!1,c="";if(m().query.artifactId===void 0?c=h.value:c=(_=m().query.artifactId)==null?void 0:_.toString(),c===""&&(F.value.identifier=!0,u=!0),u){re();return}const p={header:{identifier:c,type:"negotiation_card",timestamp:-1,creator:""},body:e.value};if(L(p))try{await $fetch(R.public.apiPath+"/model/"+n+"/version/"+t+"/artifact",{retry:0,method:"POST",headers:{Authorization:"Bearer "+q.value},body:{artifact:p,force:V.value,parents:!1},onRequestError(){P()},onResponse({response:o}){o.ok&&(ue("negotiation card",c),V.value=!0,m().query.artifactId===void 0&&(window.location="/negotiation-card?model="+m().query.model+"&version="+m().query.version+"&artifactId="+c))},onResponseError({response:o}){$(o.status,o._data.error_description)}})}catch{}else console.log("Invalid document attempting to be submitted.")}function E(n,t){const c=n.target.files[0];if(c!==null){const p=new FileReader;p.onload=_=>{try{const o=JSON.parse(_.target.result??"");if(t==="System Context")o.goals.forEach(a=>{let i=e.value.nc_data.system.goals.length-1;H(e.value.nc_data.system.goals[i])||(U.value.parentAddGoal(),i+=1),e.value.nc_data.system.goals[i].description=a.goal,e.value.nc_data.system.goals[i].metrics[0].description=a.metric,e.value.nc_data.system.goals[i].metrics[0].baseline=a.baseline}),e.value.nc_data.system.task=o.task,e.value.nc_data.system.problem_type=o.ml_problem_type.ml_problem.toLowerCase().split(" ").join("_"),e.value.nc_data.system.usage_context=o.usage_context,e.value.nc_data.system.risks.fp=o.risks.risk_fp,e.value.nc_data.system.risks.fn=o.risks.risk_fn,e.value.nc_data.system.risks.other=o.risks.risk_other;else if(t==="Raw Data"){let a=e.value.nc_data.data.length-1;z(e.value.nc_data.data[a])||(b.value.parentAddDataItem(),a+=1);let i="";o.data_sources.forEach((l,s)=>{l.data_source==="Other"?i+=l.other_source:i+=l.data_source,s+1<o.data_sources.length&&(i+=", ")}),e.value.nc_data.data[a].source=i,e.value.nc_data.data[a].labels.splice(0,1),o.labels_distribution.forEach((l,s)=>{b.value.parentAddLabel(a),e.value.nc_data.data[a].labels[s].name=l.label,e.value.nc_data.data[a].labels[s].percentage=l.percentage}),e.value.nc_data.data[a].rights=o.data_rights,e.value.nc_data.data[a].policies=o.data_policies,e.value.nc_data.data[a].description=o.dataset_description,e.value.nc_data.data[a].fields.splice(0,1),o.schema.forEach((l,s)=>{b.value.parentAddField(a),e.value.nc_data.data[a].fields[s].name=l.field_name,e.value.nc_data.data[a].fields[s].description=l.field_description,e.value.nc_data.data[a].fields[s].type=l.field_type,e.value.nc_data.data[a].fields[s].expected_values=l.expected_values,e.value.nc_data.data[a].fields[s].missing_values=l.interpret_missing,e.value.nc_data.data[a].fields[s].special_values=l.interpret_special})}else t==="Development Environment"?(e.value.nc_data.model.development_compute_resources.gpu=o.computing_resources.gpu,e.value.nc_data.model.development_compute_resources.cpu=o.computing_resources.cpu,e.value.nc_data.model.development_compute_resources.memory=o.computing_resources.memory,e.value.nc_data.model.development_compute_resources.storage=o.computing_resources.storage,o.upstream_components.forEach(a=>{a.output_spec.forEach(i=>{let l=e.value.nc_data.model.input_specification.length-1;B(e.value.nc_data.model.input_specification[l])||(x.value.parentAddInputSpec(),l+=1),e.value.nc_data.model.input_specification[l]={name:a.component_name+"."+i.item_name,description:i.item_description,type:i.item_type,expected_values:i.expected_values}})}),o.downstream_components.forEach(a=>{a.input_spec.forEach(i=>{let l=e.value.nc_data.model.output_specification.length-1;B(e.value.nc_data.model.output_specification[l])||(x.value.parentAddOutputSpec(),l+=1),e.value.nc_data.model.output_specification[l]={name:a.component_name+"."+i.item_name,description:i.item_description,type:i.item_type,expected_values:i.expected_values}})})):t==="Production Environment"&&(e.value.nc_data.model.production_compute_resources.gpu=o.computing_resources.gpu,e.value.nc_data.model.production_compute_resources.cpu=o.computing_resources.cpu,e.value.nc_data.model.production_compute_resources.memory=o.computing_resources.memory,e.value.nc_data.model.production_compute_resources.storage=o.computing_resources.storage)}catch(o){console.error("Invalid JSON or error in parsing file."),console.log(o)}},p.readAsText(c)}}function H(n){let t=!0;return n.description!==""&&(t=!1),n.metrics.forEach(u=>{(u.description!==""||u.baseline!=="")&&(t=!1)}),t}function z(n){let t=!0;return(n.description!==""||n.source!==""||n.classification!=="unclassified"||n.access!==""||n.labeling_method!=="")&&(t=!1),n.labels.forEach(u=>{(u.name!==""||u.description!==""||u.percentage!==0)&&(t=!1)}),n.fields.forEach(u=>{(u.name!==""||u.description!==""||u.type!==""||u.expected_values!==""||u.missing_values!==""||u.special_values!=="")&&(t=!1)}),t}function B(n){let t=!0;return(n.name!==""||n.description!==""||n.type!==""||n.expected_values!=="")&&(t=!1),t}return(n,t)=>{const u=G,c=O("UsaTextInput"),p=X,_=K,o=W,a=Y,i=O("UsaButton"),l=ae;return S(),j(l,{name:"base-layout"},{"page-title":y(()=>[v("Negotiation Card")]),"right-sidebar":y(()=>[r("div",null,[v(" TEC Import "),de,r("div",me,[pe,r("input",{class:"usa-file-input",type:"file",accept:".json",onChange:t[0]||(t[0]=s=>E(s,"System Context"))},null,32),_e,r("input",{class:"usa-file-input",type:"file",accept:".json",onChange:t[1]||(t[1]=s=>E(s,"Raw Data"))},null,32),fe,r("input",{class:"usa-file-input",type:"file",accept:".json",onChange:t[2]||(t[2]=s=>E(s,"Development Environment"))},null,32),ve,r("input",{class:"usa-file-input",type:"file",accept:".json",onChange:t[3]||(t[3]=s=>E(s,"Production Environment"))},null,32)])])]),default:y(()=>[ce,ye,ge,he,("useRoute"in n?n.useRoute:d(m))().query.artifactId===void 0?(S(),j(c,{key:0,modelValue:d(h),"onUpdate:modelValue":t[4]||(t[4]=s=>oe(h)?h.value=s:null),error:d(F).identifier},{label:y(()=>[v(" Artifact ID "),g(u,null,{default:y(()=>[v(" The Artifact ID this negotiation card "),be,v(" will be saved under upon submission. ")]),_:1})]),"error-message":y(()=>[v(" Identifier cannot be empty ")]),_:1},8,["modelValue","error"])):(S(),se("div",Ee,[xe,v(" "+N(d(A))+" - "+N(d(w)),1)])),g(p,{ref_key:"systemInformationRef",ref:U,modelValue:d(e).nc_data.system,"onUpdate:modelValue":t[5]||(t[5]=s=>d(e).nc_data.system=s)},null,8,["modelValue"]),g(_,{ref_key:"dataRef",ref:b,modelValue:d(e).nc_data.data,"onUpdate:modelValue":t[6]||(t[6]=s=>d(e).nc_data.data=s)},null,8,["modelValue"]),g(o,{ref_key:"modelRef",ref:x,modelValue:d(e).nc_data.model,"onUpdate:modelValue":t[7]||(t[7]=s=>d(e).nc_data.model=s)},null,8,["modelValue"]),g(a,{modelValue:d(e).nc_data.system_requirements,"onUpdate:modelValue":t[8]||(t[8]=s=>d(e).nc_data.system_requirements=s)},null,8,["modelValue"]),r("div",ke,[g(i,{class:"primary-button",onClick:t[9]||(t[9]=s=>("cancelFormSubmission"in n?n.cancelFormSubmission:d(le))("/"))},{default:y(()=>[v(" Cancel ")]),_:1}),g(i,{class:"primary-button",onClick:t[10]||(t[10]=s=>M())},{default:y(()=>[v(" Save ")]),_:1})])]),_:1})}}});export{Fe as default};
