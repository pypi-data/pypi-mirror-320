[tox]
envlist = py,html,pdf,report

[testenv]
usedevelop = true
deps = sphinx
    pytest
commands =
    pytest tests

[testenv:clean]
allowlist_externals=sh
commands = 
    sh -c "rm -rf {toxworkdir}/doc_*"
    sh -c "rm -rf {toxworkdir}/coverage*"

[testenv:html]
usedevelop = true
description = invoke sphinx-build to build the HTML docs
deps = sphinx
    coverage
commands = 
    coverage run --data-file {toxworkdir}/coverage_html -m sphinx.cmd.build -d "{toxworkdir}/doc_htmldoctree" doc "{toxworkdir}/doc_html" -W -E -bhtml

[testenv:pdf]
usedevelop = true
description = invoke sphinx-build to build the PDF docs
deps = sphinx
    coverage
allowlist_externals=sh
commands = 
    coverage run --data-file {toxworkdir}/coverage_pdf -m sphinx.cmd.build -d "{toxworkdir}/doc_pdfdoctree" doc "{toxworkdir}/doc_pdf" -W -E -blatex
    sh -c "cd {toxworkdir}/doc_pdf && make && cd ../.."

[testenv:report]
description = Build coverage report
deps = coverage
commands = 
    coverage combine --data-file {toxworkdir}/coverage {toxworkdir}/coverage_html {toxworkdir}/coverage_pdf
    coverage report --data-file {toxworkdir}/coverage 
    coverage html --data-file {toxworkdir}/coverage -d {toxworkdir}/coverage-html/
    coverage xml --data-file {toxworkdir}/coverage -o {toxworkdir}/coverage.xml
