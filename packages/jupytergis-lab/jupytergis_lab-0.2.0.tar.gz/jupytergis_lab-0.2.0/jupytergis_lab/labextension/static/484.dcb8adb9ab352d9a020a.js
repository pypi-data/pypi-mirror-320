"use strict";(self.webpackChunk_jupytergis_jupytergis_lab=self.webpackChunk_jupytergis_jupytergis_lab||[]).push([[484],{484:(e,o,n)=>{n.r(o),n.d(o,{default:()=>M});var t=n(521),a=n(883),r=n(161),d=n(862),s=n(589),m=n(670),c=n(458),i=n(256),l=n(903),u=n(230),g=n(677);class p extends g.JupyterYModel{}class y extends i.Panel{constructor(e){super(),this.onResize=()=>{this._jgisWidget&&u.MessageLoop.sendMessage(this._jgisWidget,i.Widget.ResizeMessage.UnknownSize)},this.addClass("jupytergis-notebook-widget"),this._jgisWidget=new t.JupyterGISPanel(e),this.addWidget(this._jgisWidget)}}const I={id:"jupytergis:yjswidget-plugin",autoStart:!0,optional:[g.IJupyterYWidgetManager,l.ICollaborativeDrive],activate:(e,o,n)=>{o?n?o.registerWidget("@jupytergis:widget",class extends p{ydocFactory(e){const{path:o,format:t,contentType:r}=e,d=t,s=n.sharedModelFactory.createNew({path:o,format:d,contentType:r,collaborative:!0});return this.jupyterGISModel=new a.JupyterGISModel({sharedModel:s}),this.jupyterGISModel.sharedModel.ydoc}},class{constructor(e,o){this.yModel=e,this.node=o;const n=new y({model:e.jupyterGISModel});u.MessageLoop.sendMessage(n,i.Widget.Msg.BeforeAttach),o.appendChild(n.node),u.MessageLoop.sendMessage(n,i.Widget.Msg.AfterAttach)}}):console.error("Cannot setup JupyterGIS Python API without a collaborative drive"):console.error("Missing IJupyterYWidgetManager token!")}},j="jupytergis",M=[{id:"jupytergis:lab:main-menu",autoStart:!0,requires:[a.IJupyterGISDocTracker,a.IJGISFormSchemaRegistryToken,a.IJGISLayerBrowserRegistryToken,m.IStateDB],optional:[s.IMainMenu,c.ITranslator,d.ICompletionProviderManager],activate:(e,o,n,a,r,d,s,m)=>{console.log("jupytergis:lab:main-menu is activated!"),s=null!=s?s:c.nullTranslator;(0,t.createDefaultLayerRegistry)(a),t.GlobalStateDbManager.getInstance().initialize(r),(0,t.addCommands)(e,o,s,n,a,r,m);const l=new i.Menu({commands:e.commands});l.title.label=s.load("jupyterlab").__("Add Source"),l.id="jp-gis-contextmenu-addSource",e.contextMenu.addItem({type:"submenu",selector:".jp-gis-sourcePanel",rank:3,submenu:l}),l.addItem({command:t.CommandIDs.newRasterSource,args:{from:"contextMenu"}}),l.addItem({command:t.CommandIDs.newVectorSource,args:{from:"contextMenu"}}),l.addItem({command:t.CommandIDs.newGeoJSONSource,args:{from:"contextMenu"}}),l.addItem({command:t.CommandIDs.newRasterDemSource,args:{from:"contextMenu"}}),l.addItem({command:t.CommandIDs.newImageSource,args:{from:"contextMenu"}}),e.contextMenu.addItem({type:"separator",selector:".jp-gis-sourcePanel",rank:2}),e.contextMenu.addItem({selector:".jp-gis-source.jp-gis-sourceUnused",rank:1,command:t.CommandIDs.removeSource}),e.commands.addKeyBinding({command:t.CommandIDs.removeSource,keys:["Delete"],selector:".jp-gis-source.jp-gis-sourceUnused"}),e.contextMenu.addItem({selector:".jp-gis-source",rank:1,command:t.CommandIDs.renameSource}),e.commands.addKeyBinding({command:t.CommandIDs.renameSource,keys:["F2"],selector:".jp-gis-sourceItem"}),e.contextMenu.addItem({command:t.CommandIDs.symbology,selector:".jp-gis-layerItem",rank:1}),e.contextMenu.addItem({type:"separator",selector:".jp-gis-layerPanel",rank:1}),e.contextMenu.addItem({command:t.CommandIDs.removeLayer,selector:".jp-gis-layerItem",rank:2}),e.commands.addKeyBinding({command:t.CommandIDs.removeLayer,keys:["Delete"],selector:".jp-gis-layerItem"}),e.contextMenu.addItem({command:t.CommandIDs.renameLayer,selector:".jp-gis-layerItem",rank:2}),e.commands.addKeyBinding({command:t.CommandIDs.renameLayer,keys:["F2"],selector:".jp-gis-layerItem"});const u=new i.Menu({commands:e.commands});u.title.label=s.load("jupyterlab").__("Move Selected Layers to Group"),u.id="jp-gis-contextmenu-movelayer",e.contextMenu.addItem({type:"submenu",selector:".jp-gis-layerItem",rank:2,submenu:u}),e.contextMenu.opened.connect((()=>function(e,o){var n,a,r,d;if(!(null===(n=o.currentWidget)||void 0===n?void 0:n.context.model))return;const s=null===(a=o.currentWidget)||void 0===a?void 0:a.context.model,m=null!==(d=null===(r=e.menu.items.find((e=>{var o;return"submenu"===e.type&&"jp-gis-contextmenu-movelayer"===(null===(o=e.submenu)||void 0===o?void 0:o.id)})))||void 0===r?void 0:r.submenu)&&void 0!==d?d:null;if(!m)return;m.clearItems();const c=function e(o){const n=[];for(const t of o)if("string"!=typeof t&&t.layers){n.push(t.name);const o=e(t.layers);n.push(...o)}return n}(s.getLayerTree());m.addItem({command:t.CommandIDs.moveLayersToGroup,args:{label:""}}),c.forEach((e=>{m.addItem({command:t.CommandIDs.moveLayersToGroup,args:{label:e}})})),m.addItem({command:t.CommandIDs.moveLayerToNewGroup})}(e.contextMenu,o))),e.contextMenu.addItem({command:t.CommandIDs.removeGroup,selector:".jp-gis-layerGroupHeader",rank:2}),e.commands.addKeyBinding({command:t.CommandIDs.removeGroup,keys:["Delete"],selector:".jp-gis-layerGroupHeader"}),e.contextMenu.addItem({command:t.CommandIDs.renameGroup,selector:".jp-gis-layerGroupHeader",rank:2}),e.commands.addKeyBinding({command:t.CommandIDs.renameGroup,keys:["F2"],selector:".jp-gis-layerGroupHeader"}),e.contextMenu.addItem({type:"separator",selector:".jp-gis-layerPanel",rank:2});const g=new i.Menu({commands:e.commands});g.title.label=s.load("jupyterlab").__("Add Layer"),g.id="jp-gis-contextmenu-addLayer",e.contextMenu.addItem({type:"submenu",selector:".jp-gis-layerPanel",rank:3,submenu:g}),g.addItem({command:t.CommandIDs.newRasterLayer,args:{from:"contextMenu"}}),g.addItem({command:t.CommandIDs.newVectorLayer,args:{from:"contextMenu"}}),g.addItem({command:t.CommandIDs.newHillshadeLayer,args:{from:"contextMenu"}}),g.addItem({command:t.CommandIDs.newImageLayer,args:{from:"contextMenu"}}),d&&function(e,o){e.editMenu.undoers.redo.add({id:t.CommandIDs.redo,isEnabled:o}),e.editMenu.undoers.undo.add({id:t.CommandIDs.undo,isEnabled:o})}(d,(()=>null!==o.currentWidget&&o.currentWidget===e.shell.currentWidget)),e.commands.addKeyBinding({command:t.CommandIDs.executeConsole,keys:["Shift Enter"],selector:".jpgis-console .jp-CodeConsole[data-jp-interaction-mode='notebook'] .jp-CodeConsole-promptCell"}),e.commands.addKeyBinding({command:t.CommandIDs.invokeCompleter,keys:["Tab"],selector:".jpgis-console .jp-CodeConsole-promptCell .jp-mod-completer-enabled"}),e.commands.addKeyBinding({command:t.CommandIDs.selectCompleter,keys:["Enter"],selector:".jpgis-console .jp-ConsolePanel .jp-mod-completer-active"})}},{id:"jupytergis:lab:controlpanel",autoStart:!0,requires:[r.ILayoutRestorer,a.IJupyterGISDocTracker,a.IJGISFormSchemaRegistryToken,m.IStateDB,a.IAnnotationToken],activate:(e,o,n,a,r,d)=>{const s=new t.ControlPanelModel({tracker:n}),m=new t.LeftPanelWidget({model:s,tracker:n,state:r});m.id="jupytergis::leftControlPanel",m.title.caption="JupyterGIS Control Panel",m.title.icon=t.logoMiniIcon;const c=new t.RightPanelWidget({model:s,tracker:n,formSchemaRegistry:a,annotationModel:d});c.id="jupytergis::rightControlPanel",c.title.caption="JupyterGIS Control Panel",c.title.icon=t.logoMiniIcon,o&&(o.add(m,j),o.add(c,j)),e.shell.add(m,"left",{rank:2e3}),e.shell.add(c,"right",{rank:2e3})}},I]}}]);