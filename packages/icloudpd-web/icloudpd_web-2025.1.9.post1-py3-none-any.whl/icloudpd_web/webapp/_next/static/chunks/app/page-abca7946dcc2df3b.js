(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4032:(e,s,i)=>{Promise.resolve().then(i.bind(i,8962))},8962:(e,s,i)=>{"use strict";i.r(s),i.d(s,{default:()=>ez});var n=i(5155),o=i(2115),l=i(3166),r=i(3085),t=i(9949),a=i(5389),c=i(3420),d=i(9829),h=i(674),u=i(2403),x=i(4462),p=i(2369),j=i(3083),g=i(6677),m=i(2311),f=i(4252),b=i(4999),v=i(4825),_=i(7504),y=i(4619),w=i(7389),C=i(863),S=i(3129),k=i(2295),z=i(5135),E=i(4681),O=i(3031),D=i(3792),M=i(1319);function P(){return"guest-"+Math.random().toString(36).substring(2,8)}function W(e){let[s,i]=(0,o.useState)(null);return(0,o.useEffect)(()=>{console.log("Attempting to connect to WebSocket server...");let s=(0,M.io)("/",{transports:["websocket"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,auth:{clientId:e.clientId}});return s.on("connect",()=>{console.log("Connected to Python server")}),s.on("connect_error",e=>{console.error("Socket connection error:",e.message)}),s.on("disconnect",e=>{console.log("Socket disconnected:",e)}),["policies","uploaded_policies","policies_after_save","policies_after_delete"].forEach(e=>{s.on(e,s=>{console.log("".concat(e,":"),s)})}),["error_saving_policy","error_deleting_policy","error_interrupting_download"].forEach(e=>{s.on(e,s=>{console.error("".concat(e,":"),s)})}),s.on("authenticated",e=>{console.log("Authentication successful:",e)}),s.on("authentication_failed",e=>{console.error("Authentication failed:",e)}),s.on("mfa_required",e=>{console.log("MFA required:",e)}),s.on("download_progress",e=>{console.log("Download progress:",e)}),s.on("download_finished",e=>{console.log("Download finished:",e)}),s.on("download_failed",e=>{console.error("Download failed:",e)}),i(s),()=>{console.log("Cleaning up socket connection"),s.close()}},[e.clientId]),s}function R(e){let{label:s,info:i,children:o}=e,{isOpen:r,onToggle:a}=(0,l.j)();return(0,n.jsxs)(t.a,{children:[(0,n.jsxs)(h.z,{spacing:2,align:"center",mb:i&&r?2:0,h:"40px",children:[(0,n.jsx)(u.K,{"aria-label":"Toggle info",icon:r?(0,n.jsx)(O.M,{}):(0,n.jsx)(D.D,{}),size:"sm",variant:"ghost",onClick:a}),(0,n.jsx)(x.l,{flex:"1",mb:"0",children:s}),o]}),i&&(0,n.jsx)(p.S,{in:r,children:(0,n.jsx)(t.a,{pl:10,pr:4,py:2,bg:"gray.50",borderRadius:"md",children:(0,n.jsx)(j.E,{fontSize:"sm",color:"gray.600",children:i})})})]})}function F(e){let{isOpen:s,onClose:i,onPolicySaved:l,isEditing:a=!1,policy:u,socketConfig:x}=e,p=(0,r.d)(),O=W(x),[D,M]=(0,o.useState)({name:(null==u?void 0:u.name)||"",username:(null==u?void 0:u.username)||"",directory:(null==u?void 0:u.directory)||"",domain:(null==u?void 0:u.domain)||"com",folder_structure:(null==u?void 0:u.folder_structure)||"{:%Y/%m/%d}",size:(null==u?void 0:u.size)||["original"],live_photo_size:(null==u?void 0:u.live_photo_size)||"original",force_size:(null==u?void 0:u.force_size)||!1,align_raw:(null==u?void 0:u.align_raw)||"original",keep_unicode_in_filenames:(null==u?void 0:u.keep_unicode_in_filenames)||!1,set_exif_datetime:(null==u?void 0:u.set_exif_datetime)||!1,live_photo_mov_filename_policy:(null==u?void 0:u.live_photo_mov_filename_policy)||"suffix",file_match_policy:(null==u?void 0:u.file_match_policy)||"name-size-dedup-with-suffix",xmp_sidecar:(null==u?void 0:u.xmp_sidecar)||!1,use_os_locale:(null==u?void 0:u.use_os_locale)||!1,album:(null==u?void 0:u.album)||"All Photos",library:(null==u?void 0:u.library)||"Personal Library",recent:(null==u?void 0:u.recent)||null,until_found:(null==u?void 0:u.until_found)||null,skip_videos:(null==u?void 0:u.skip_videos)||!1,skip_live_photos:(null==u?void 0:u.skip_live_photos)||!1,auto_delete:(null==u?void 0:u.auto_delete)||!1,delete_after_download:(null==u?void 0:u.delete_after_download)||!1,dry_run:(null==u?void 0:u.dry_run)||!1,interval:(null==u?void 0:u.interval)||null,log_level:(null==u?void 0:u.log_level)||"info"});return(0,n.jsxs)(g.aF,{isOpen:s,onClose:i,isCentered:!0,motionPreset:"slideInBottom",size:"xl",scrollBehavior:"inside",children:[(0,n.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,n.jsxs)(f.$,{maxW:"800px",w:"90%",bg:"white",borderRadius:"2xl",boxShadow:"xl",children:[(0,n.jsx)(b.r,{fontFamily:"Inter, sans-serif",children:a?"Edit Policy":"New Policy"}),(0,n.jsx)(v.s,{}),(0,n.jsx)(_.c,{pb:6,children:(0,n.jsxs)(c.T,{spacing:4,align:"stretch",divider:(0,n.jsx)(t.a,{h:"1px",bg:"gray.100"}),children:[(0,n.jsxs)(t.a,{children:[(0,n.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Basic Settings"}),(0,n.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,n.jsx)(y.MJ,{isRequired:!0,children:(0,n.jsx)(R,{label:"Policy Name",info:"A unique name to identify this policy",children:(0,n.jsx)(w.p,{value:D.name,onChange:e=>M({...D,name:e.target.value}),maxW:"300px"})})}),(0,n.jsx)(y.MJ,{isRequired:!0,children:(0,n.jsx)(R,{label:"iCloud Username",info:"Your iCloud account email address",children:(0,n.jsx)(w.p,{value:D.username,onChange:e=>M({...D,username:e.target.value}),maxW:"300px"})})}),(0,n.jsx)(y.MJ,{isRequired:!0,children:(0,n.jsx)(R,{label:"Download Directory",info:"The local directory where photos will be downloaded",children:(0,n.jsx)(w.p,{value:D.directory,onChange:e=>M({...D,directory:e.target.value}),maxW:"300px"})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Domain",info:"The iCloud service domain to use",children:(0,n.jsxs)(C.l,{value:D.domain,onChange:e=>M({...D,domain:e.target.value}),maxW:"100px",children:[(0,n.jsx)("option",{value:"com",children:"com"}),(0,n.jsx)("option",{value:"cn",children:"cn"})]})})})]})]}),(0,n.jsxs)(t.a,{children:[(0,n.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Download Options"}),(0,n.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Folder Structure",info:"The folder structure pattern using Python's strftime format",children:(0,n.jsx)(w.p,{value:D.folder_structure,onChange:e=>M({...D,folder_structure:e.target.value}),maxW:"200px"})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"File Match Policy",info:"The policy for matching files when downloading",children:(0,n.jsxs)(C.l,{value:D.file_match_policy,onChange:e=>M({...D,file_match_policy:e.target.value}),maxW:"150px",children:[(0,n.jsx)("option",{value:"name-size-dedup-with-suffix",children:"Name-Size-Dedup-With-Suffix"}),(0,n.jsx)("option",{value:"name-id7",children:"Name-Id7"})]})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Live Photo Size",info:"The size of live photos to download",children:(0,n.jsxs)(C.l,{value:D.live_photo_size,onChange:e=>M({...D,live_photo_size:e.target.value}),maxW:"150px",children:[(0,n.jsx)("option",{value:"original",children:"Original"}),(0,n.jsx)("option",{value:"medium",children:"Medium"}),(0,n.jsx)("option",{value:"thumb",children:"Thumb"})]})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Live Photo Video Filename Policy",info:"The policy for naming live photo videos",children:(0,n.jsxs)(C.l,{value:D.live_photo_mov_filename_policy,onChange:e=>M({...D,live_photo_mov_filename_policy:e.target.value}),maxW:"150px",children:[(0,n.jsx)("option",{value:"original",children:"Original"}),(0,n.jsx)("option",{value:"suffix",children:"Suffix"})]})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Raw File Size",info:"The size of raw files to download",children:(0,n.jsxs)(C.l,{value:D.align_raw,onChange:e=>M({...D,align_raw:e.target.value}),maxW:"150px",children:[(0,n.jsx)("option",{value:"original",children:"Original"}),(0,n.jsx)("option",{value:"alternative",children:"Alternative"}),(0,n.jsx)("option",{value:"as-is",children:"As-Is"})]})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Download Sizes",info:"Select one or more sizes for downloaded photos",children:(0,n.jsx)(h.z,{spacing:4,pl:2,children:["original","medium","thumb","adjusted","alternative"].map(e=>(0,n.jsx)(S.S,{isChecked:D.size.includes(e),onChange:s=>{let i=s.target.checked?[...D.size,e]:D.size.filter(s=>s!==e);M({...D,size:i})},children:e.charAt(0).toUpperCase()+e.slice(1)},e))})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Force Sizes",info:"Force the use of the selected sizes during download",children:(0,n.jsx)(k.d,{checked:D.force_size,onChange:e=>M({...D,force_size:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Keep Unicode in Filenames",info:"Preserve Unicode characters in filenames instead of converting them",children:(0,n.jsx)(k.d,{checked:D.keep_unicode_in_filenames,onChange:e=>M({...D,keep_unicode_in_filenames:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Set EXIF Datetime",info:"Set the EXIF datetime in the downloaded photos",children:(0,n.jsx)(k.d,{checked:D.set_exif_datetime,onChange:e=>M({...D,set_exif_datetime:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"XMP Sidecar",info:"Create XMP sidecar files for the downloaded photos",children:(0,n.jsx)(k.d,{checked:D.xmp_sidecar,onChange:e=>M({...D,xmp_sidecar:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Use OS Locale",info:"Use the operating system's locale settings",children:(0,n.jsx)(k.d,{checked:D.use_os_locale,onChange:e=>M({...D,use_os_locale:e.target.checked})})})})]})]}),(0,n.jsxs)(t.a,{children:[(0,n.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Filter Options"}),(0,n.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Album",info:"The album to download from. Choose from a list of albums when the policy is authenticated. Note that user-created albums only exist in Personal Library and trying to download them from a Shared Library will result in an error. Default: All Photos",children:(null==u?void 0:u.authenticated)&&u.albums?(0,n.jsx)(C.l,{value:u.albums.includes(D.album)?D.album:"",onChange:e=>M({...D,album:e.target.value}),maxW:"200px",placeholder:"Select an album",children:u.albums.map(e=>(0,n.jsx)("option",{value:e,children:e},e))}):(0,n.jsx)(w.p,{value:D.album,onChange:e=>M({...D,album:e.target.value}),maxW:"200px",placeholder:"Enter album name"})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Library",info:"The library to download from. Personal Library will be used if you do not have a shared library. Default: Personal Library",children:(0,n.jsxs)(C.l,{value:D.library,onChange:e=>M({...D,library:e.target.value}),maxW:"200px",children:[(0,n.jsx)("option",{value:"Personal Library",children:"Personal Library"}),(0,n.jsx)("option",{value:"Shared Library",children:"Shared Library"})]})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Download Recent X",info:"Stop downloading after X recent photos are downloaded (leave empty for all)",children:(0,n.jsx)(z.Q7,{value:D.recent||"",onChange:e=>M({...D,recent:""===e?null:parseInt(e)}),min:0,maxW:"100px",children:(0,n.jsx)(z.OO,{})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Download Until Found X",info:"Stop downloading after X existing photos are checked (leave empty for all)",children:(0,n.jsx)(z.Q7,{value:D.until_found||"",onChange:e=>M({...D,until_found:""===e?null:parseInt(e)}),min:0,maxW:"100px",children:(0,n.jsx)(z.OO,{})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Skip Videos",info:"Skip downloading video files",children:(0,n.jsx)(k.d,{checked:D.skip_videos,onChange:e=>M({...D,skip_videos:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Skip Live Photos",info:"Skip downloading live photos",children:(0,n.jsx)(k.d,{checked:D.skip_live_photos,onChange:e=>M({...D,skip_live_photos:e.target.checked})})})})]})]}),(0,n.jsxs)(t.a,{children:[(0,n.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Delete Options"}),(0,n.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Auto Delete",info:"Automatically delete photos that are no longer in iCloud",children:(0,n.jsx)(k.d,{checked:D.auto_delete,onChange:e=>M({...D,auto_delete:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Delete After Download",info:"Delete photos from iCloud after successful download",children:(0,n.jsx)(k.d,{checked:D.delete_after_download,onChange:e=>M({...D,delete_after_download:e.target.checked})})})})]})]}),(0,n.jsxs)(t.a,{children:[(0,n.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Server Options"}),(0,n.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Dry Run",info:"Simulate the download process without actually downloading or modifying any files",children:(0,n.jsx)(k.d,{isChecked:D.dry_run,onChange:e=>M({...D,dry_run:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Schedule Interval",info:"The schedule to run the policy as a cron job (leave empty to keep it manual)",children:(0,n.jsx)(w.p,{value:D.interval||"",onChange:e=>M({...D,interval:e.target.value}),maxW:"200px"})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(R,{label:"Log Level",info:"The level of detail in log messages",children:(0,n.jsxs)(C.l,{value:D.log_level,onChange:e=>M({...D,log_level:e.target.value}),maxW:"200px",children:[(0,n.jsx)("option",{value:"debug",children:"Debug"}),(0,n.jsx)("option",{value:"info",children:"Info"}),(0,n.jsx)("option",{value:"error",children:"Error"})]})})})]})]})]})}),(0,n.jsxs)(E.j,{children:[(0,n.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},mr:3,borderRadius:"xl",fontFamily:"Inter, sans-serif",onClick:()=>{if(!O)return;let e=a?"policies_after_save":"policies_after_create";O.once(e,e=>{p({title:"Success",description:'Policy "'.concat(D.name,'" ').concat(a?"saved":"created"," successfully"),status:"success",duration:3e3,isClosable:!0}),i(),l&&l(e)}),O.once(a?"error_saving_policy":"error_creating_policy",s=>{let{policy_name:i,error:n}=s;p({title:"Error",description:"Failed to ".concat(a?"save":"create",' policy "').concat(i,'": ').concat(n),status:"error",duration:5e3,isClosable:!0}),O.off(e)}),a?O.emit("savePolicy",null==u?void 0:u.name,D):O.emit("createPolicy",D)},children:"Save"}),(0,n.jsx)(d.$,{onClick:i,borderRadius:"xl",fontFamily:"Inter, sans-serif",variant:"ghost",_hover:{bg:"gray.100"},children:"Cancel"})]})]})]})}var I=i(1911);function A(e){let{isOpen:s,onClose:i,onConfirm:l,policyName:r}=e,t=(0,o.useRef)(null);return(0,n.jsx)(I.Lt,{isOpen:s,leastDestructiveRef:t,onClose:i,isCentered:!0,children:(0,n.jsx)(m.m,{children:(0,n.jsxs)(I.EO,{borderRadius:"xl",children:[(0,n.jsx)(b.r,{fontSize:"lg",fontWeight:"bold",children:"Delete Policy"}),(0,n.jsxs)(_.c,{children:['Are you sure you want to delete policy "',r,'"? This action cannot be undone.']}),(0,n.jsxs)(E.j,{children:[(0,n.jsx)(d.$,{ref:t,onClick:i,borderRadius:"xl",children:"Cancel"}),(0,n.jsx)(d.$,{colorScheme:"red",onClick:()=>{l(),i()},ml:3,borderRadius:"xl",children:"Delete"})]})]})})})}var L=i(2533),T=i(5442),J=i(8613),$=i(5184),K=i(9335),U=i(9616),N=i(9365),q=i(6280);function H(e){let s,i,{onSettingsClick:r,onLogoutClick:a}=e,{isOpen:c,onOpen:d,onClose:h}=(0,l.j)(),{isOpen:u,onOpen:x,onClose:p}=(0,l.j)(),j=()=>{clearTimeout(s),d()},g=()=>{s=setTimeout(h,100)},m=()=>{clearTimeout(i),x()},f=()=>{i=setTimeout(p,100)};return(0,o.useEffect)(()=>()=>{clearTimeout(s),clearTimeout(i)},[]),(0,n.jsx)(t.a,{bg:"white",borderBottom:"1px",borderColor:"gray.200",py:4,position:"sticky",top:0,zIndex:1,children:(0,n.jsx)(t.a,{mx:"auto",width:"100%",children:(0,n.jsxs)(L.s,{maxW:"container.xl",mx:"auto",width:"100%",justify:"space-between",align:"center",pr:6,children:[(0,n.jsx)(T.D,{fontSize:"24px",fontWeight:"bold",fontFamily:"Inter, sans-serif",color:"black",children:"iCloud Photos Downloader"}),(0,n.jsxs)(L.s,{gap:4,align:"center",children:[(0,n.jsx)(t.a,{onMouseEnter:m,onMouseLeave:f,children:(0,n.jsxs)(J.W,{isOpen:u,isLazy:!0,gutter:1,children:[(0,n.jsx)($.I,{as:t.a,color:u?"gray.800":"gray.600",_hover:{color:"gray.800",cursor:"pointer"},fontFamily:"Inter, sans-serif",fontSize:"14px",fontWeight:"semibold",children:"Github"}),(0,n.jsx)(K.Z,{children:(0,n.jsxs)(U.c,{onMouseEnter:m,onMouseLeave:f,fontSize:"13px",color:"gray.600",minW:"auto",children:[(0,n.jsx)(N.D,{as:"a",href:"https://github.com/AirswitchAsa/icloudpd-web",target:"_blank",rel:"noopener noreferrer",_hover:{color:"gray.800"},children:"Project icloudpd-web"}),(0,n.jsx)(N.D,{as:"a",href:"https://icloud-photos-downloader.github.io/icloud_photos_downloader/",target:"_blank",rel:"noopener noreferrer",_hover:{color:"gray.800"},children:"Documentation (icloudpd)"})]})})]})}),(0,n.jsx)(t.a,{onMouseEnter:j,onMouseLeave:g,children:(0,n.jsxs)(J.W,{isOpen:c,isLazy:!0,gutter:1,children:[(0,n.jsx)($.I,{as:t.a,color:c?"gray.800":"gray.600",_hover:{color:"gray.800",cursor:"pointer"},fontFamily:"Inter, sans-serif",fontSize:"14px",fontWeight:"semibold",children:"My App"}),(0,n.jsx)(K.Z,{children:(0,n.jsxs)(U.c,{onMouseEnter:j,onMouseLeave:g,fontSize:"13px",color:"gray.600",minW:"auto",children:[(0,n.jsxs)(N.D,{onClick:r,_hover:{color:"gray.800"},children:[(0,n.jsx)(q.GD,{style:{marginRight:"8px"}}),"Settings"]}),(0,n.jsxs)(N.D,{onClick:a,_hover:{color:"gray.800"},children:[(0,n.jsx)(q.xsM,{style:{marginRight:"8px"}}),"Log out"]})]})})]})})]})]})})})}var B=i(1683);function G(e){let{title:s,children:i,headerRight:o,...l}=e;return(0,n.jsx)(t.a,{width:"100%",...l,children:(0,n.jsxs)(t.a,{bg:"white",borderRadius:"2xl",boxShadow:"sm",border:"1px",borderColor:"gray.200",display:"flex",flexDirection:"column",children:[(0,n.jsxs)(L.s,{px:12,borderBottom:"1px",borderColor:"gray.100",height:"56px",alignItems:"center",children:[(0,n.jsx)(j.E,{fontSize:"14px",fontWeight:"semibold",color:"gray.600",letterSpacing:"0.05em",pl:2,children:s.toUpperCase()}),(0,n.jsx)(B.h,{}),o]}),(0,n.jsx)(t.a,{pt:2,pb:10,px:12,flex:"1",minH:"200px",display:"flex",alignItems:"flex-start",width:"100%",children:i})]})})}var X=i(206),Y=i(1889),V=i(4893),Q=i(4605),Z=i(6317),ee=i(6434),es=i(6344),ei=i(921),en=i(1536);let eo=e=>{let{isOpen:s,onClose:i,onConfirm:l,policyName:r}=e,t=(0,o.useRef)(null);return(0,n.jsx)(I.Lt,{isOpen:s,leastDestructiveRef:t,onClose:i,children:(0,n.jsx)(m.m,{children:(0,n.jsxs)(I.EO,{children:[(0,n.jsx)(b.r,{fontSize:"lg",fontWeight:"bold",children:"Interrupt Download"}),(0,n.jsxs)(_.c,{children:["Are you sure you want to interrupt the policy ",r,"? All downloaded files will be kept."]}),(0,n.jsxs)(E.j,{children:[(0,n.jsx)(d.$,{ref:t,onClick:i,children:"Cancel"}),(0,n.jsx)(d.$,{colorScheme:"red",onClick:l,ml:3,children:"Confirm"})]})]})})})},el=e=>{let{policy:s,setPolicies:i,onEdit:r,onDelete:a,onRun:c,onInterrupt:h,socket:x,toast:g}=e,{isOpen:m,onToggle:f}=(0,l.j)(),{isOpen:b,onOpen:v,onClose:_}=(0,l.j)(),[y,w]=(0,o.useState)(!1);(0,o.useEffect)(()=>{"running"===s.status&&w(!1)},[s.status]);let C=(e=>"running"===e.status?{text:"running",color:"blue.500"}:"errored"===e.status?{text:"errored",color:"red.500"}:e.authenticated?100===e.progress?{text:"done",color:"green.500"}:{text:"ready",color:"green.500"}:{text:"unauthenticated",color:"gray.500"})(s);return(0,n.jsxs)(t.a,{width:"100%",borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:[(0,n.jsxs)(L.s,{p:4,justify:"space-between",align:"center",bg:m?"gray.50":"white",onClick:f,cursor:"pointer",_hover:{bg:"gray.50"},children:[(0,n.jsxs)(L.s,{flex:1,gap:4,children:[(0,n.jsx)(u.K,{"aria-label":"Expand row",icon:m?(0,n.jsx)(O.M,{}):(0,n.jsx)(D.D,{}),variant:"ghost",size:"sm"}),(0,n.jsxs)(t.a,{flex:1,children:[(0,n.jsx)(j.E,{fontSize:"16px",fontWeight:"medium",children:s.name}),(0,n.jsxs)(L.s,{gap:2,color:"gray.500",fontSize:"14px",children:[(0,n.jsx)(j.E,{color:C.color,fontWeight:"medium",children:C.text}),(0,n.jsx)(j.E,{children:"•"}),(0,n.jsx)(j.E,{children:s.username}),(0,n.jsx)(j.E,{children:"•"}),(0,n.jsx)(j.E,{children:s.directory})]})]}),(0,n.jsx)(t.a,{width:"150px",display:"flex",children:(0,n.jsxs)(t.a,{flex:"1",mt:1,children:[(0,n.jsx)(j.E,{fontSize:"12px",color:"gray.600",fontWeight:"medium",children:"running"===s.status?"".concat(s.progress||0,"%"):"IDLE"}),(0,n.jsx)(Q.k,{value:s.progress||0,size:"sm",colorScheme:"running"===s.status?"blue":"errored"===s.status?"red":"green",borderRadius:"full"})]})})]}),(0,n.jsxs)(L.s,{gap:2,ml:4,children:[y?(0,n.jsx)(u.K,{"aria-label":"Loading",icon:(0,n.jsx)(V.y,{size:"sm"}),colorScheme:"blue",variant:"ghost",size:"sm"}):"running"===s.status?(0,n.jsx)(u.K,{"aria-label":"Pause download",icon:(0,n.jsx)(en.kwt,{}),colorScheme:"blue",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),v()}}):(0,n.jsx)(u.K,{"aria-label":"Run policy",icon:(0,n.jsx)(en.gSK,{}),colorScheme:"green",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),x&&s.authenticated&&(w(!0),x.once("icloud_is_busy",()=>{w(!1)}),x.once("download_failed",()=>{w(!1)})),c(s)}}),(0,n.jsx)(u.K,{"aria-label":"Edit policy",icon:(0,n.jsx)(Z.q,{}),colorScheme:"blue",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),r(s)},isDisabled:"running"===s.status}),(0,n.jsx)(u.K,{"aria-label":"Duplicate policy",icon:(0,n.jsx)(ee.T,{}),colorScheme:"blue",variant:"ghost",size:"sm",onClick:e=>{if(e.stopPropagation(),!x)return;let n={...s,name:"".concat(s.name," COPY"),authenticated:!1};x.once("policies_after_create",e=>{i(e)}),x.once("error_creating_policy",e=>{let{policy_name:s,error:i}=e;g({title:"Error",description:'Failed to create policy "'.concat(s,'": ').concat(i),status:"error",duration:5e3,isClosable:!0})}),x.emit("createPolicy",n)},isDisabled:"running"===s.status}),(0,n.jsx)(u.K,{"aria-label":"Delete policy",icon:(0,n.jsx)(es.d,{}),colorScheme:"red",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),a(s)},isDisabled:"running"===s.status})]})]}),(0,n.jsx)(eo,{isOpen:b,onClose:_,onConfirm:()=>{h(s),_()},policyName:s.name}),(0,n.jsx)(p.S,{in:m,children:(0,n.jsxs)(t.a,{p:4,bg:"gray.50",children:[(0,n.jsx)(t.a,{ml:12,maxH:"300px",overflowY:"auto",sx:{"&::-webkit-scrollbar":{width:"8px",borderRadius:"8px",backgroundColor:"rgba(0, 0, 0, 0.05)"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0, 0, 0, 0.1)",borderRadius:"8px","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.15)"}}},children:(0,n.jsx)(j.E,{fontSize:"14px",fontFamily:"monospace",whiteSpace:"pre-wrap",sx:{wordBreak:"break-word"},children:s.logs||"No logs available"})}),s.logs&&"running"!==s.status&&(0,n.jsx)(L.s,{justify:"flex-start",mt:4,ml:12,children:(0,n.jsx)(d.$,{leftIcon:(0,n.jsx)(ei.s,{}),size:"sm",variant:"outline",colorScheme:"blue",onClick:e=>{if(e.stopPropagation(),!s.logs)return;let i=new Blob([s.logs],{type:"text/plain"}),n=URL.createObjectURL(i),o=document.createElement("a");o.href=n,o.download="".concat(s.name,"-logs.txt"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)},children:"Export Logs"})})]})})]})},er=e=>{let{isOpen:s,onClose:i,onImport:o}=e;return(0,n.jsxs)(g.aF,{isOpen:s,onClose:i,children:[(0,n.jsx)(m.m,{}),(0,n.jsxs)(f.$,{children:[(0,n.jsx)(b.r,{children:"Import Policies"}),(0,n.jsx)(v.s,{}),(0,n.jsx)(_.c,{children:(0,n.jsx)(j.E,{children:"Select a TOML file containing policy definitions to import."})}),(0,n.jsx)(E.j,{children:(0,n.jsx)(d.$,{colorScheme:"blue",onClick:o,children:"Choose File"})})]})]})},et=e=>{let{isOpen:s,onClose:i,onExport:o}=e;return(0,n.jsxs)(g.aF,{isOpen:s,onClose:i,children:[(0,n.jsx)(m.m,{}),(0,n.jsxs)(f.$,{children:[(0,n.jsx)(b.r,{children:"Export Policies"}),(0,n.jsx)(v.s,{}),(0,n.jsx)(_.c,{children:(0,n.jsx)(j.E,{children:"Download your policies as a TOML file."})}),(0,n.jsx)(E.j,{children:(0,n.jsx)(d.$,{colorScheme:"blue",onClick:o,children:"Download"})})]})]})};var ea=i(2863),ec=i(1741),ed=i(6152),eh=i(6084);let eu=e=>{let{selectedUsernames:s,setSelectedUsernames:i,uniqueUsernames:o}=e;return(0,n.jsxs)(J.W,{children:[(0,n.jsx)($.I,{as:u.K,"aria-label":"Filter policies",icon:(0,n.jsx)(ed.R,{}),variant:"ghost",colorScheme:"gray"}),(0,n.jsx)(U.c,{color:"gray.600",minW:"auto",children:(0,n.jsx)(t.a,{px:4,py:2,children:(0,n.jsx)(ea.$,{value:s,onChange:e=>i(e),children:(0,n.jsxs)(ec.B,{children:[(0,n.jsx)(S.S,{value:"All",onChange:e=>{e.target.checked?i(["All"]):i([])},children:(0,n.jsx)(j.E,{fontSize:"14px",children:"All"})}),o.map(e=>(0,n.jsx)(S.S,{value:e,isChecked:s.includes(e),onChange:n=>{n.target.checked?s.includes("All")?i([e]):i([...s,e]):i(s.filter(s=>s!==e))},children:(0,n.jsx)(j.E,{fontSize:"14px",children:e})},e))]})})})})]})},ex=e=>{let{setSortConfig:s}=e,[i,l]=(0,o.useState)("none"),[r,t]=(0,o.useState)("asc"),a=e=>{let n;i===e?t(n="asc"===r?"desc":"asc"):t(n="asc"),l(e),s({field:e,direction:n})};return(0,n.jsxs)(J.W,{closeOnSelect:!1,children:[(0,n.jsx)($.I,{as:u.K,"aria-label":"Sort policies",icon:(0,n.jsx)(eh.Dwj,{}),variant:"ghost",colorScheme:"gray",_hover:{bg:"transparent"}}),(0,n.jsxs)(U.c,{fontSize:"13px",color:"gray.600",minW:"150px",children:[(0,n.jsx)(N.D,{onClick:()=>{l("none"),s({field:"none",direction:"asc"})},_hover:{bg:"transparent"},children:(0,n.jsx)(h.z,{spacing:2,width:"100%",justify:"space-between",children:(0,n.jsx)(j.E,{children:"Manual"})})}),(0,n.jsx)(N.D,{onClick:()=>a("name"),_hover:{bg:"transparent"},children:(0,n.jsxs)(h.z,{spacing:2,width:"100%",justify:"space-between",children:[(0,n.jsx)(j.E,{children:"Policy Name"}),"name"===i&&("asc"===r?(0,n.jsx)(eh.rH8,{}):(0,n.jsx)(eh.stI,{}))]})}),(0,n.jsx)(N.D,{onClick:()=>a("username"),_hover:{bg:"transparent"},children:(0,n.jsxs)(h.z,{spacing:2,width:"100%",justify:"space-between",children:[(0,n.jsx)(j.E,{children:"Username"}),"username"===i&&("asc"===r?(0,n.jsx)(eh.rH8,{}):(0,n.jsx)(eh.stI,{}))]})}),(0,n.jsx)(N.D,{onClick:()=>a("status"),_hover:{bg:"transparent"},children:(0,n.jsxs)(h.z,{spacing:2,width:"100%",justify:"space-between",children:[(0,n.jsx)(j.E,{children:"Status"}),"status"===i&&("asc"===r?(0,n.jsx)(eh.rH8,{}):(0,n.jsx)(eh.stI,{}))]})})]})]})},ep=e=>{let{policies:s,setPolicies:i,onEdit:r,onDelete:a,onRun:d,onInterrupt:h,socket:x,toast:p}=e,[g,m]=(0,o.useState)(s),[f,b]=(0,o.useState)(["All"]),[v,_]=(0,o.useState)({field:"none",direction:"asc"}),y=(0,o.useRef)(null),{isOpen:w,onOpen:C,onClose:S}=(0,l.j)(),{isOpen:k,onOpen:z,onClose:E}=(0,l.j)(),O=Array.from(new Set(s.map(e=>e.username))),D=e=>{var s;if(!e.authenticated)return 4;switch(null===(s=e.status)||void 0===s?void 0:s.toLowerCase()){case"running":return 1;case"errored":return 0;case"stopped":return 2;default:return 3}};(0,o.useEffect)(()=>{let e=[...s];f.includes("All")||(e=e.filter(e=>f.includes(e.username))),"none"!==v.field&&e.sort((e,s)=>{let i=0;switch(v.field){case"name":i=e.name.localeCompare(s.name);break;case"username":i=e.username.localeCompare(s.username);break;case"status":i=D(e)-D(s)}return"asc"===v.direction?i:-i}),m(e)},[s,f,v]);let M=async e=>{var s;let n=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!n||!x)return;let o=await n.text();x.emit("uploadPolicies",o),x.once("uploaded_policies",e=>{i(e),p({title:"Success",description:"Policies imported successfully",status:"success",duration:3e3,isClosable:!0})}),x.once("error_uploading_policies",e=>{let{error:s}=e;p({title:"Error",description:"Failed to import policies: ".concat(s),status:"error",duration:5e3,isClosable:!0})}),S(),y.current&&(y.current.value="")};return(0,n.jsxs)(c.T,{spacing:2,width:"100%",align:"stretch",children:[(0,n.jsxs)(L.s,{justify:"space-between",gap:2,children:[(0,n.jsxs)(L.s,{gap:2,children:[(0,n.jsx)("input",{type:"file",ref:y,onChange:M,accept:".toml",style:{display:"none"}}),(0,n.jsx)(u.K,{"aria-label":"Import policies",icon:(0,n.jsx)(X.ekc,{}),onClick:C,variant:"ghost",colorScheme:"gray"}),(0,n.jsx)(u.K,{"aria-label":"Export policies",icon:(0,n.jsx)(Y.bOW,{}),onClick:z,variant:"ghost",colorScheme:"gray"})]}),(0,n.jsxs)(L.s,{gap:2,children:[(0,n.jsx)(eu,{selectedUsernames:f,setSelectedUsernames:b,uniqueUsernames:O}),(0,n.jsx)(ex,{setSortConfig:_})]})]}),(0,n.jsx)(er,{isOpen:w,onClose:S,onImport:()=>{var e;null===(e=y.current)||void 0===e||e.click()}}),(0,n.jsx)(et,{isOpen:k,onClose:E,onExport:()=>{x&&(x.emit("downloadPolicies"),x.once("error_downloading_policies",e=>{let{error:s}=e;p({title:"Error",description:"Failed to export policies: ".concat(s),status:"error",duration:5e3,isClosable:!0})}),x.once("downloaded_policies",e=>{let s=new Blob([e],{type:"text/plain"}),i=URL.createObjectURL(s),n=document.createElement("a");n.href=i,n.download="policies.toml",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i),E()}))}}),g.length>0?g.map(e=>(0,n.jsx)(el,{policy:e,setPolicies:i,onEdit:r,onDelete:a,onRun:d,onInterrupt:h,socket:x,toast:p},e.name)):(0,n.jsx)(t.a,{height:"100px",display:"grid",placeItems:"center",children:(0,n.jsx)(j.E,{color:"gray.500",textAlign:"center",fontFamily:"Inter, sans-serif",fontSize:"14px",children:"No available policies. Create a new one or import from a file."})})]})};var ej=i(7511),eg=i(6758),em=i(4895),ef=i(6742);function eb(e){let{isOpen:s,onClose:i,onSubmit:l,username:r,socket:t}=e,[a,c]=(0,o.useState)(""),[h,p]=(0,o.useState)(!1),[v,C]=(0,o.useState)(!1),S=()=>{t&&(C(!0),t.once("authenticated",()=>{C(!1),i()}),t.once("authentication_failed",()=>{C(!1)}),l(a),c(""))};return(0,n.jsxs)(g.aF,{isOpen:s,onClose:i,isCentered:!0,children:[(0,n.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,n.jsxs)(f.$,{borderRadius:"xl",children:[(0,n.jsx)(b.r,{children:"Authentication Required"}),(0,n.jsx)(_.c,{children:(0,n.jsxs)(y.MJ,{children:[(0,n.jsx)(x.l,{children:v?(0,n.jsx)(L.s,{gap:2,align:"center",children:(0,n.jsx)(j.E,{children:"Authenticating..."})}):"Enter the password for iCloud user ".concat(r)}),(0,n.jsxs)(ej.M,{children:[(0,n.jsx)(w.p,{type:h?"text":"password",value:a,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"===e.key&&a&&S()}}),(0,n.jsx)(eg.t,{children:(0,n.jsx)(u.K,{"aria-label":h?"Hide password":"Show password",icon:h?(0,n.jsx)(em.O,{}):(0,n.jsx)(ef.t,{}),variant:"ghost",onClick:()=>p(!h),size:"sm"})})]})]})}),(0,n.jsxs)(E.j,{children:[(0,n.jsx)(d.$,{variant:"ghost",mr:3,onClick:i,children:"Cancel"}),(0,n.jsx)(d.$,{colorScheme:"blue",onClick:S,isDisabled:!a||v,isLoading:v,children:"Submit"})]})]})]})}function ev(e){let{isOpen:s,onClose:i,onSubmit:l,error:r,socket:t}=e,[a,h]=(0,o.useState)(""),[u,p]=(0,o.useState)(!1),v=()=>{t&&(p(!0),t.once("authenticated",()=>{p(!1),i()}),t.once("authentication_failed",()=>{p(!1)}),t.once("mfa_required",()=>{p(!1)}),l(a),h(""))};return(0,n.jsxs)(g.aF,{isOpen:s,onClose:i,isCentered:!0,children:[(0,n.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,n.jsxs)(f.$,{borderRadius:"xl",children:[(0,n.jsx)(b.r,{children:"Two-Factor Authentication"}),(0,n.jsx)(_.c,{children:(0,n.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,n.jsxs)(y.MJ,{children:[(0,n.jsx)(x.l,{children:u?(0,n.jsx)(L.s,{gap:2,align:"center",children:(0,n.jsx)(j.E,{children:"Verifying..."})}):"Verification code is sent to your trusted devices"}),(0,n.jsx)(w.p,{type:"text",value:a,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&a&&v()},placeholder:"Enter code",isDisabled:u})]}),r&&(0,n.jsx)(j.E,{color:"red.500",fontSize:"sm",children:r})]})}),(0,n.jsxs)(E.j,{children:[(0,n.jsx)(d.$,{variant:"ghost",mr:3,onClick:i,isDisabled:u,children:"Cancel"}),(0,n.jsx)(d.$,{colorScheme:"blue",onClick:v,isDisabled:!a||u,isLoading:u,children:"Submit"})]})]})]})}var e_=i(3983),ey=i(3750);function ew(e){let{isOpen:s,socket:i,onAuthenticated:r}=e,[t,a]=(0,o.useState)(""),[p,v]=(0,o.useState)(!1),[C,S]=(0,o.useState)(!1),[k,z]=(0,o.useState)(),[O,D]=(0,o.useState)(""),[M,W]=(0,o.useState)(""),[R,F]=(0,o.useState)(!1),[I,A]=(0,o.useState)(!1),[L,T]=(0,o.useState)(!1),[J,$]=(0,o.useState)({no_password:!1,always_guest:!1,disable_guest:!1}),{isOpen:K,onOpen:U,onClose:N}=(0,l.j)(),q=O===M,H=""!==M&&!q;(0,o.useEffect)(()=>{if(i)return i.emit("getServerConfig"),i.on("server_config",e=>{$(e)}),()=>{i.off("server_config")}},[i,r]),(0,o.useEffect)(()=>{J.no_password?r("default-user",!1):J.always_guest&&r(P(),!0)},[J,r]);let B=()=>{i&&(S(!0),z(void 0),i.emit("authenticate_local",t))},G=()=>{i&&q&&(T(!0),z(void 0),i.once("server_secret_reset",()=>{a("")}),i.once("failed_resetting_server_secret",e=>{z(e.error)}),i.emit("reset_secret"),i.emit("save_secret","",O))};return null==i||i.once("server_authenticated",()=>{S(!1),a(""),r("default-user",!1)}),null==i||i.once("server_authentication_failed",e=>{S(!1),z(e.error)}),null==i||i.once("server_secret_reset",()=>{a("")}),null==i||i.once("failed_resetting_server_secret",e=>{z(e.error)}),null==i||i.once("server_secret_saved",()=>{T(!1),D(""),W(""),N()}),null==i||i.once("failed_saving_server_secret",e=>{T(!1),z(e.error)}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(g.aF,{isOpen:s,onClose:()=>{},isCentered:!0,closeOnOverlayClick:!1,closeOnEsc:!1,children:[(0,n.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,n.jsxs)(f.$,{borderRadius:"xl",children:[(0,n.jsx)(b.r,{children:"Server Authentication"}),(0,n.jsx)(_.c,{children:(0,n.jsxs)(c.T,{spacing:4,children:[(0,n.jsxs)(y.MJ,{children:[(0,n.jsx)(x.l,{children:C?"Authenticating...":"Enter server password"}),(0,n.jsxs)(ej.M,{children:[(0,n.jsx)(w.p,{type:p?"text":"password",value:t,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"===e.key&&t&&B()}}),(0,n.jsx)(eg.t,{children:(0,n.jsx)(u.K,{"aria-label":p?"Hide password":"Show password",icon:p?(0,n.jsx)(em.O,{}):(0,n.jsx)(ef.t,{}),variant:"ghost",onClick:()=>v(!p),size:"sm"})})]})]}),k&&(0,n.jsx)(j.E,{color:"red.500",fontSize:"sm",alignSelf:"flex-start",py:0,children:k}),(0,n.jsxs)(h.z,{spacing:4,width:"100%",justify:"space-between",children:[(0,n.jsx)(e_.N,{color:"gray.700",fontSize:"14px",onClick:()=>{z(""),U()},textDecoration:"underline",cursor:"pointer",children:"Reset server password"}),!J.disable_guest&&(0,n.jsx)(e_.N,{color:"gray.700",fontSize:"14px",onClick:()=>{i&&(i.once("logout_complete",()=>{r(P(),!0)}),i.emit("logOut","default-user"))},textDecoration:"underline",cursor:"pointer",children:"Continue as guest"})]})]})}),(0,n.jsx)(E.j,{children:(0,n.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},onClick:B,isDisabled:!t||C,isLoading:C,children:"Submit"})})]})]}),(0,n.jsxs)(g.aF,{isOpen:K,onClose:()=>{},isCentered:!0,closeOnOverlayClick:!1,closeOnEsc:!1,children:[(0,n.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,n.jsxs)(f.$,{borderRadius:"xl",children:[(0,n.jsx)(b.r,{children:"Set New Password"}),(0,n.jsx)(_.c,{children:(0,n.jsxs)(c.T,{spacing:4,children:[(0,n.jsxs)(y.MJ,{isInvalid:H,children:[(0,n.jsx)(x.l,{children:"New Password"}),(0,n.jsxs)(ej.M,{children:[(0,n.jsx)(w.p,{type:R?"text":"password",value:O,onChange:e=>D(e.target.value),onKeyDown:e=>{"Enter"===e.key&&O&&q&&G()}}),(0,n.jsx)(eg.t,{children:(0,n.jsx)(u.K,{"aria-label":R?"Hide password":"Show password",icon:R?(0,n.jsx)(em.O,{}):(0,n.jsx)(ef.t,{}),variant:"ghost",onClick:()=>F(!R),size:"sm"})})]})]}),(0,n.jsxs)(y.MJ,{isInvalid:H,children:[(0,n.jsx)(x.l,{children:"Confirm Password"}),(0,n.jsxs)(ej.M,{children:[(0,n.jsx)(w.p,{type:I?"text":"password",value:M,onChange:e=>W(e.target.value),onKeyDown:e=>{"Enter"===e.key&&M&&q&&G()}}),(0,n.jsx)(eg.t,{children:(0,n.jsx)(u.K,{"aria-label":I?"Hide password":"Show password",icon:I?(0,n.jsx)(em.O,{}):(0,n.jsx)(ef.t,{}),variant:"ghost",onClick:()=>A(!I),size:"sm"})})]}),H&&(0,n.jsx)(ey.Wt,{children:"Passwords do not match"})]}),k&&(0,n.jsx)(j.E,{color:"red.500",fontSize:"sm",alignSelf:"flex-start",children:k})]})}),(0,n.jsx)(E.j,{children:(0,n.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},onClick:G,isDisabled:!O||!M||!q||L,isLoading:L,children:"Set Password"})})]})]})]})}function eC(){return(0,n.jsx)(t.a,{children:(0,n.jsx)(c.T,{spacing:6,align:"stretch",children:(0,n.jsx)(j.E,{color:"gray.500",children:"There are no general settings at the moment."})})})}let eS=[{id:"general",label:"General",component:eC},{id:"download",label:"Download",component:function(){return(0,n.jsx)(t.a,{children:(0,n.jsx)(c.T,{spacing:6,align:"stretch",children:(0,n.jsx)(j.E,{color:"gray.500",children:"There are no download settings at the moment."})})})}},{id:"user",label:"User",component:function(e){let{socket:s,isGuest:i}=e,[l,a]=(0,o.useState)(""),[h,p]=(0,o.useState)(""),[g,m]=(0,o.useState)(""),[f,b]=(0,o.useState)(!1),[v,_]=(0,o.useState)(!1),[C,S]=(0,o.useState)(!1),[z,E]=(0,o.useState)(!1),[O,D]=(0,o.useState)({no_password:!1,always_guest:!1,disable_guest:!1}),M=(0,r.d)(),P=h===g,W=""!==g&&!P;(0,o.useEffect)(()=>{if(s)return s.emit("getServerConfig"),s.on("server_config",e=>{D(e)}),()=>{s.off("server_config")}},[s]);let R=e=>i=>{s&&(s.once("app_config_updated",()=>{D(s=>({...s,[e]:i})),M({title:"Success",description:"Access control settings updated",status:"success",duration:3e3,isClosable:!0})}),s.once("error_updating_app_config",e=>{s.emit("getServerConfig"),M({title:"Error",description:e.error,status:"error",duration:5e3,isClosable:!0})}),s.emit("updateAppConfig",e,i))};return(0,n.jsx)(t.a,{children:(0,n.jsxs)(c.T,{spacing:8,align:"stretch",children:[(0,n.jsxs)(t.a,{children:[(0,n.jsx)(j.E,{fontWeight:"bold",fontSize:"lg",mb:4,children:"Change Password"}),(0,n.jsxs)(c.T,{spacing:3,align:"stretch",maxW:"400px",children:[(0,n.jsxs)(y.MJ,{children:[(0,n.jsx)(x.l,{fontSize:"sm",children:"Current Password"}),(0,n.jsxs)(ej.M,{size:"sm",children:[(0,n.jsx)(w.p,{type:f?"text":"password",value:l,onChange:e=>a(e.target.value)}),(0,n.jsx)(eg.t,{children:(0,n.jsx)(u.K,{"aria-label":f?"Hide password":"Show password",icon:f?(0,n.jsx)(em.O,{}):(0,n.jsx)(ef.t,{}),variant:"ghost",onClick:()=>b(!f),size:"sm"})})]})]}),(0,n.jsxs)(y.MJ,{isInvalid:W,children:[(0,n.jsx)(x.l,{fontSize:"sm",children:"New Password"}),(0,n.jsxs)(ej.M,{size:"sm",children:[(0,n.jsx)(w.p,{type:v?"text":"password",value:h,onChange:e=>p(e.target.value)}),(0,n.jsx)(eg.t,{children:(0,n.jsx)(u.K,{"aria-label":v?"Hide password":"Show password",icon:v?(0,n.jsx)(em.O,{}):(0,n.jsx)(ef.t,{}),variant:"ghost",onClick:()=>_(!v),size:"sm"})})]})]}),(0,n.jsxs)(y.MJ,{isInvalid:W,children:[(0,n.jsx)(x.l,{fontSize:"sm",children:"Confirm New Password"}),(0,n.jsxs)(ej.M,{size:"sm",children:[(0,n.jsx)(w.p,{type:C?"text":"password",value:g,onChange:e=>m(e.target.value)}),(0,n.jsx)(eg.t,{children:(0,n.jsx)(u.K,{"aria-label":C?"Hide password":"Show password",icon:C?(0,n.jsx)(em.O,{}):(0,n.jsx)(ef.t,{}),variant:"ghost",onClick:()=>S(!C),size:"sm"})})]}),W&&(0,n.jsx)(ey.Wt,{children:"Passwords do not match"})]}),(0,n.jsx)(t.a,{pt:2,children:(0,n.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},onClick:()=>{s&&P&&(E(!0),s.once("server_secret_saved",()=>{E(!1),a(""),p(""),m(""),M({title:"Success",description:"Server password has been updated",status:"success",duration:3e3,isClosable:!0})}),s.once("failed_saving_server_secret",e=>{E(!1),M({title:"Error",description:e.error,status:"error",duration:5e3,isClosable:!0})}),s.emit("save_secret",l,h))},isDisabled:!l||!h||!g||!P||z||i,isLoading:z,size:"sm",children:"Update Password"})})]})]}),(0,n.jsxs)(t.a,{children:[(0,n.jsx)(j.E,{fontWeight:"bold",fontSize:"lg",mb:4,children:"Access Control"}),(0,n.jsxs)(c.T,{spacing:3,align:"stretch",maxW:"400px",children:[(0,n.jsxs)(y.MJ,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,n.jsx)(x.l,{fontSize:"sm",mb:0,children:"No Password Required"}),(0,n.jsx)(k.d,{isChecked:O.no_password,onChange:e=>R("no_password")(e.target.checked),isDisabled:i})]}),(0,n.jsxs)(y.MJ,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,n.jsx)(x.l,{fontSize:"sm",mb:0,children:"Always Use Guest Mode"}),(0,n.jsx)(k.d,{isChecked:O.always_guest,onChange:e=>R("always_guest")(e.target.checked),isDisabled:i&&!O.always_guest})]}),(0,n.jsxs)(y.MJ,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,n.jsx)(x.l,{fontSize:"sm",mb:0,children:"Disable Guest Access"}),(0,n.jsx)(k.d,{isChecked:O.disable_guest,onChange:e=>R("disable_guest")(e.target.checked),isDisabled:i})]})]})]})]})})}}];function ek(e){var s;let{isOpen:i,onClose:l,socket:r,isGuest:a}=e,[h,u]=(0,o.useState)("general"),x=(null===(s=eS.find(e=>e.id===h))||void 0===s?void 0:s.component)||eC;return(0,n.jsxs)(g.aF,{isOpen:i,onClose:l,size:"4xl",isCentered:!0,children:[(0,n.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,n.jsxs)(f.$,{borderRadius:"xl",children:[(0,n.jsx)(b.r,{borderBottomWidth:"1px",children:"Settings"}),(0,n.jsx)(_.c,{p:0,children:(0,n.jsxs)(L.s,{h:"600px",children:[(0,n.jsx)(t.a,{w:"240px",borderRightWidth:"1px",p:6,children:(0,n.jsx)(c.T,{spacing:2,align:"stretch",children:eS.map(e=>(0,n.jsx)(t.a,{py:2,px:4,cursor:"pointer",borderRadius:"md",bg:h===e.id?"gray.100":"transparent",_hover:{bg:h===e.id?"gray.100":"gray.50"},onClick:()=>u(e.id),children:(0,n.jsx)(j.E,{fontSize:"sm",fontWeight:h===e.id?"semibold":"normal",color:h===e.id?"black":"gray.600",children:e.label})},e.id))})}),(0,n.jsx)(t.a,{flex:1,p:8,overflowY:"auto",children:(0,n.jsx)(x,{socket:r,isGuest:a})})]})}),(0,n.jsx)(E.j,{borderTopWidth:"1px",children:(0,n.jsx)(d.$,{variant:"ghost",onClick:l,children:"Close"})})]})]})}function ez(){let[e,s]=(0,o.useState)([]),[i,h]=(0,o.useState)(),[u,x]=(0,o.useState)(),[p,j]=(0,o.useState)(),[g,m]=(0,o.useState)(),[f,b]=(0,o.useState)(!1),[v,_]=(0,o.useState)({clientId:"default-user",isGuest:!1}),{isOpen:y,onOpen:w,onClose:C}=(0,l.j)(),{isOpen:S,onOpen:k,onClose:z}=(0,l.j)(),{isOpen:E,onOpen:O,onClose:D}=(0,l.j)(),{isOpen:M,onOpen:P,onClose:R}=(0,l.j)(),{isOpen:I,onOpen:L,onClose:T}=(0,l.j)(),J=W(v),$=(0,r.d)();!function(e){let{socket:s,toast:i,setPolicies:n}=e;(0,o.useEffect)(()=>{if(!s)return;s.emit("getPolicies");let e=["policies","policies_after_save","policies_after_delete"];e.forEach(e=>{s.on(e,s=>{n(s),"policies"!==e&&i({title:"Success",description:{policies_after_save:"Policy saved successfully",policies_after_delete:"Policy deleted successfully"}[e],status:"success",duration:3e3,isClosable:!0})})});let o={connect_error:"Failed to connect to server",error_saving_policy:"Failed to save policy",error_deleting_policy:"Failed to delete policy",error_interrupting_download:"Failed to interrupt download",authentication_failed:"Authentication failed"};Object.entries(o).forEach(e=>{let[n,o]=e;s.on(n,e=>{let s=(null==e?void 0:e.error)||(null==e?void 0:e.message)||"",n=(null==e?void 0:e.policy_name)?' "'.concat(e.policy_name,'"'):"";i({title:"Error",description:"".concat(o).concat(n).concat(s?": "+s:""),status:"error",duration:5e3,isClosable:!0})})}),s.on("download_failed",e=>{let{policy:s,error:n,logs:o}=e;l(s),o&&r(s.name,o),i({title:"Error",description:'Error downloading photos for policy "'.concat(s.name,'": ').concat(n),status:"error",duration:5e3,isClosable:!0})}),s.on("authenticated",e=>{let{msg:s,policies:o}=e;i({title:"Authentication Successful",description:s,status:"success",duration:3e3,isClosable:!0}),n(o)}),s.on("mfa_required",e=>{i({title:"MFA Required",description:e,status:"info",duration:3e3,isClosable:!0})}),s.on("icloud_is_busy",e=>{i({title:"iCloud Account Busy",description:e,status:"info",duration:5e3,isClosable:!0})});let l=e=>{n(s=>s.map(s=>s.name===e.name?{...s,...e}:s))},r=(e,s)=>{n(i=>i.map(i=>i.name===e?{...i,logs:(i.logs||"")+s}:i))};return s.on("download_progress",e=>{let{policy:s,logs:i}=e;l(s),i&&r(s.name,i)}),s.on("download_finished",e=>{let{policy_name:s,progress:n,logs:o}=e;l({name:s,progress:n,status:"stopped"}),o&&r(s,o),i({title:"Download Complete",description:'Successfully downloaded photos for policy "'.concat(s,'"'),status:"success",duration:5e3,isClosable:!0})}),()=>{e.forEach(e=>s.off(e)),Object.keys(o).forEach(e=>s.off(e)),s.off("authenticated"),s.off("mfa_required"),s.off("download_progress"),s.off("download_finished"),s.off("download_failed"),s.off("icloud_is_busy")}},[s,i,n])}({socket:J,toast:$,setPolicies:s}),(0,o.useEffect)(()=>{if(!J)return;let e=()=>{D(),R()},s=e=>{D(),m(e),P()},i=()=>{b(!0)};return J.on("authenticated",e),J.on("mfa_required",s),J.on("server_authenticated",i),()=>{J.off("authenticated",e),J.off("mfa_required",s),J.off("server_authenticated",i)}},[J,p,D,R,P]);let K=()=>{h(void 0),C()};return f?(0,n.jsxs)(t.a,{bg:"gray.200",minH:"100vh",children:[(0,n.jsx)(H,{onSettingsClick:L,onLogoutClick:()=>{J&&(J.emit("logOut",v.clientId),b(!1),_({clientId:"default-user",isGuest:!1}))}}),(0,n.jsxs)(a.m,{maxW:"container.xl",py:8,children:[(0,n.jsx)(c.T,{spacing:8,align:"center",width:"100%",children:(0,n.jsx)(t.a,{width:"100%",children:(0,n.jsx)(G,{title:"Policies",headerRight:(0,n.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},borderRadius:"xl",fontFamily:"Inter, sans-serif",fontSize:"12px",size:"sm",px:4,onClick:()=>{h(void 0),w()},children:"Add"}),children:(0,n.jsx)(ep,{policies:e,setPolicies:s,onEdit:e=>{h(e),w()},onDelete:e=>{x(e),k()},onRun:e=>{J&&(e.authenticated?(e.logs="",J.emit("start",e.name)):(j(e),O()))},onInterrupt:e=>{J&&J.emit("interrupt",e.name)},socket:J,toast:$})})})}),y&&(0,n.jsx)(F,{isOpen:!0,onClose:K,onPolicySaved:e=>{s(e),K()},isEditing:!!i,policy:i,socketConfig:v}),S&&(0,n.jsx)(A,{isOpen:S,onClose:z,onConfirm:()=>{u&&(null==J||J.emit("deletePolicy",u.name),z(),x(void 0))},policyName:(null==u?void 0:u.name)||""}),E&&(0,n.jsx)(eb,{isOpen:!0,onClose:()=>{D(),j(void 0)},onSubmit:e=>{J&&p&&J.emit("authenticate",p.name,e)},username:(null==p?void 0:p.username)||"",socket:J}),M&&(0,n.jsx)(ev,{isOpen:!0,onClose:()=>{R(),j(void 0),m(void 0)},onSubmit:e=>{J&&p&&(m(void 0),J.emit("provideMFA",p.name,e))},error:g,socket:J}),I&&(0,n.jsx)(ek,{isOpen:!0,onClose:T,socket:J,isGuest:v.isGuest})]})]}):(0,n.jsx)(ew,{isOpen:!0,socket:J,onAuthenticated:(e,s)=>{_({clientId:e,isGuest:s}),b(!0)}})}}},e=>{var s=s=>e(e.s=s);e.O(0,[897,506,512,711,873,647,821,441,517,358],()=>s(4032)),_N_E=e.O()}]);